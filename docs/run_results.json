{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.10", "generated_at": "2025-11-26T16:26:30.830021Z", "invocation_id": "437a6f5e-1884-45e5-a761-d2c64acfa172", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-26T16:24:07.946597Z", "completed_at": "2025-11-26T16:24:07.978037Z"}, {"name": "execute", "started_at": "2025-11-26T16:24:07.978498Z", "completed_at": "2025-11-26T16:26:30.820292Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 142.8752326965332, "adapter_response": {"_message": "OK", "rows_affected": -1}, "message": "OK", "failures": null, "unique_id": "model.dbt_dataplatform.stg_sdes_rpls_logement", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_sdes_rpls_logement\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_sdes_rpls_logement\n * Cible :          stg_sdes_rpls_logement \n */\n\n\n\n\n with\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_sdes_rpls_logement as \n (\n    select \n        [_meta_year]                as logement_rpls_millesime,\n        [IDENT_REP]                 as logement_rpls_id,\n        [IDENT_INT]                 as logement_bailleur_systeme_id,\n        [IDENT_ORG]                 as organisme_id,\n        [DROIT]                     as immobilier_droit_code,\n        [DEPCOM]                    as commune_code,\n        [CODEPOSTAL]                as adresse_postale_code,\n        [LIBCOM]                    as commune_libelle,\n        [NUMVOIE]                   as adresse_voie_num,\n        [INDREP]                    as adresse_voie_indice_repetition_libelle,\n        [TYPVOIE]                   as adresse_voie_type_libelle,\n        [NOMVOIE]                   as adresse_voie_libelle,\n        [NUMAPPT]                   as adresse_appartement_num,\n        [NUMBOITE]                  as adresse_boite_num ,\n        [ESC]                       as adresse_escalier_num,\n        [COULOIR]                   as adresse_couloir_libelle,\n        [ETAGE]                     as adresse_etage_num ,\n        [COMPLIDENT]                as adresse_logement_complement_libelle,\n        [ENTREE]                    as adresse_entree_num,\n        [BAT]                       as adresse_batiment_num,\n        [IMMEU]                     as adresse_immeuble_num,\n        [COMPLGEO]                  as adresse_batiment_complement_libelle,\n        [LIEUDIT]                   as adresse_lieu_dit_libelle,\n        [QPV]                       as qpv_flag ,\n        [TYPECONST]                 as construction_type_code,\n        [NBPIECE]                   as piece_nombre_code,\n        [SURFHAB]                   as surface_habitable_m2,\n        [CONSTRUCT]                 as construction_achevement_annee,\n        [LOCAT]                     as mise_en_location_premiere_annee,\n        [PATRIMOINE]                as patrimoine_entree_annee,\n        [ORIGINE]                   as patrimoine_origine_code,\n        [RSEXPRO]                   as proprietaire_precedent_raison_sociale_libelle,\n        [SIRETEXPRO]                as proprietaire_precedent_siret_num,\n        [FINAN]                     as financement_initial_code,\n        [FINANAUTRE]                as financement_autre_libelle,\n        [CONV]                      as convention_flag,\n        [NUMCONV]                   as convention_num,\n        [DATCONV]                   as convention_date,\n        [SORTIEPATRIM]              as patrimoine_sortie_code,\n        [OLDLOGT]                   as logement_old_code,\n        [NEWLOGT]                   as logement_new_code,\n        [MODE]                      as occupation_mode_code,\n        [BAIL]                      as bail_effet_mois,\n        [MODESURF]                  as surface_mode_code,\n        [SURFMODE]                  as surface_mode_m2,\n        [LOYERPRINC]                as loyer_principal_mensuel_montant,\n        [LOYERACC]                  as loyer_accessoire_mensuel_montant,\n        [CONTRIB]                   as contribution_montant,\n        -- a changer\n        [CUS]                       as financement_cus_code,\n\n        [DPEDATE]                   as dpe_mois,\n        [DPEENERGIE]                as dpe_energie_code,\n        [DPESERRE]                  as dpe_ges_code,\n        [SRU_EXPIR]                 as sru_expiration_annee,\n        [SRU_ALINEA]                as sru_alinea_code,\n        [IDENTGES]                  as organisme_gestionnaire_id,\n        [CODSEGPATRIM]              as patrimoine_segment_code,\n        [LIBSEGPATRIM]              as patrimoine_segment_libelle,\n        [LOYERMAXAPL]               as loyer_maximal_apl_mensuel_montant,\n        [LOYERMAXCUS]               as loyer_maximal_cus_mensuel_montant,\n        [QUALACQ]                   as vente_type_code,\n        [MISCOMMERCIAL]             as mise_en_commercialisation_code,\n        [PRIXVENTE]                 as vente_prix_montant,\n        [PRODFIN]                   as produit_financier_net_montant,\n        [REMLOCDATE]                as remise_en_location_mois,\n        [CONTRESLOG]                as reservation_contingent_code,\n        [PMR]                       as pmr_code,\n        [DATMISEVENTE]              as vente_autorisation_mois,\n        [DATVEFFECT]                as vente_effective_mois,\n        [DATE_DEP_DERLOCAT]         as locataire_dernier_depart_date,\n        [DPE_CONSO_ENER]            as dpe_energie_consommation_valeur,\n        [DPE_CONSO_GES]             as dpe_ges_consommation_valeur,\n        [DPE_NUM_REF]               as dpe_reference_num,\n        [IDENT_FISCAL]              as logement_fiscal_id,\n        [CAT_ORG]                   as organisme_categorie_code,\n        [RS]                        as organisme_raison_sociale_libelle,\n        [SIRET]                     as organisme_siret_code,\n        [DEP]                       as departement_code,\n        [LIBDEP]                    as departement_libelle,\n        [REG]                       as region_code,\n        [LIBREG]                    as region_libelle ,\n        [EPCI]                      as epci_code ,\n        [LIBEPCI]                   as epci_libelle,\n        [DEPARTEMENTS_DE_L_EPCI]    as departements_epci_list,\n        [REGIONS_DE_L_EPCI]         as regions_epci_list,\n        --[ARN],\n        [finan_cus]                 as var_financement_groupe_libelle,\n        [mes_sanscumul]             as var_mise_en_service_flag,\n        [loymoy]                    as var_loyer_moyen_mensuel_m2_montant,\n        [age]                       as var_logement_anciennete_en_annee,\n        [deconv]                    as var_deconventionnement_flag,\n        [duree_vacance]             as var_duree_vacance_mois,\n        [ANNEE_REMLOC]              as var_remise_en_location_annee,\n        [MOIS_REMLOC]               as var_remise_en_location_mois,\n        [MOIS_BAIL]                 as var_bail_effet_mois,\n        [ANNEE_BAIL]                as var_bail_effet_annee,\n        [BAIL_DATE]                 as var_bail_effet_date ,\n        [REMLOCDATE_DATE]           as var_remise_en_location_date\n      \n \n    from   \"wh_dp_bronze\".\"raw\".\"raw_sdes_rpls_logement\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_sdes_rpls_logement as\n(\n\n    select\n \n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when logement_rpls_millesime is null \n          or logement_rpls_millesime in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(logement_rpls_millesime as integer) is not null \n        then cast(logement_rpls_millesime as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(logement_rpls_millesime as float) is not null \n        then cast(cast(logement_rpls_millesime as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n            as logement_rpls_millesime,\n        \n    case\n        when logement_rpls_millesime is null or trim(logement_rpls_millesime) = '' then CAST(NULL AS DATE)\n        when upper(trim(logement_rpls_millesime)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(logement_rpls_millesime)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(logement_rpls_millesime + '-01-01' AS DATE)\n        \n        \n    end\n        as logement_rpls_millesime_date,\n        logement_rpls_id,\n        logement_bailleur_systeme_id,\n        organisme_id,\n        \n    case \n        when immobilier_droit_code in ('NA', '0','NC','Z') or immobilier_droit_code is null \n            then 'N/A'\n        else immobilier_droit_code\n    end\n          as immobilier_droit_code,\n        commune_code,\n        adresse_postale_code,\n        commune_libelle,\n        adresse_voie_num,\n        adresse_voie_indice_repetition_libelle,\n        adresse_voie_type_libelle,\n        adresse_voie_libelle,\n        adresse_appartement_num,\n        adresse_boite_num,\n        adresse_escalier_num,\n        adresse_couloir_libelle,\n        adresse_etage_num,\n        adresse_logement_complement_libelle,\n        adresse_entree_num,\n        adresse_batiment_num,\n        adresse_immeuble_num,\n        adresse_batiment_complement_libelle,\n        adresse_lieu_dit_libelle,\n        \n  \n  case\n    when trim(qpv_flag) = '1' then cast(1 as bit)\n    else cast(0 as bit)\n  end\n as qpv_flag,\n        \n    case \n        when construction_type_code in ('NA', '0','NC','Z') or construction_type_code is null \n            then 'N/A'\n        else construction_type_code\n    end\n                 as construction_type_code,\n        piece_nombre_code,\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when surface_habitable_m2 is null \n          or surface_habitable_m2 in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(surface_habitable_m2 as integer) is not null \n        then cast(surface_habitable_m2 as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(surface_habitable_m2 as float) is not null \n        then cast(cast(surface_habitable_m2 as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n                   as surface_habitable_m2,\n        \n    case\n        when construction_achevement_annee is null or trim(construction_achevement_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(construction_achevement_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(construction_achevement_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(construction_achevement_annee + '-01-01' AS DATE)\n        \n        \n    end\n     as construction_achevement_annee,\n        \n    case\n        when mise_en_location_premiere_annee is null or trim(mise_en_location_premiere_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(mise_en_location_premiere_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(mise_en_location_premiere_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(mise_en_location_premiere_annee + '-01-01' AS DATE)\n        \n        \n    end\n   as mise_en_location_premiere_annee,\n        \n    case\n        when patrimoine_entree_annee is null or trim(patrimoine_entree_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(patrimoine_entree_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(patrimoine_entree_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(patrimoine_entree_annee + '-01-01' AS DATE)\n        \n        \n    end\n           as patrimoine_entree_annee,\n        patrimoine_origine_code,\n        proprietaire_precedent_raison_sociale_libelle,\n        proprietaire_precedent_siret_num,\n        financement_initial_code,\n        financement_autre_libelle,\n        case when  region_code in ('01', '02', '03', '04', '06') then cast (0 as bit) else  \n  \n  case\n    when trim(convention_flag) = '1' then cast(1 as bit)\n    else cast(0 as bit)\n  end\n end as convention_flag,\n        case when  region_code in ('01', '02', '03', '04', '06') then 'N/A' end as convention_num,\n        case when  region_code in ('01', '02', '03', '04', '06')  then null else \n    case\n        when convention_date is null or trim(convention_date) = '' then CAST(NULL AS DATE)\n        when upper(trim(convention_date)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(convention_date)) < 10 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(convention_date, '/', '-')), 7, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(convention_date, '/', '-')), 4, 2), '-',  -- MM\n                SUBSTRING(trim(REPLACE(convention_date, '/', '-')), 1, 2)        -- JJ\n            ) AS DATE\n        )\n    \n    end\n end as convention_date,\n        \n    case \n        when patrimoine_sortie_code in ('NA', '0','NC','Z') or patrimoine_sortie_code is null \n            then 'N/A'\n        else patrimoine_sortie_code\n    end\n as patrimoine_sortie_code,\n        logement_old_code,\n        logement_new_code,\n        \n    case \n        when occupation_mode_code in ('NA', '0','NC','Z') or occupation_mode_code is null \n            then 'N/A'\n        else occupation_mode_code\n    end\n as occupation_mode_code,\n        \n    case\n        when bail_effet_mois is null or trim(bail_effet_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(bail_effet_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(bail_effet_mois)) != 7 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(bail_effet_mois, '/', '-')), 4, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(bail_effet_mois, '/', '-')), 1, 2), '-',  -- MM\n                '01'                                                               -- JJ (par d\u00e9faut)\n            ) AS DATE\n        )\n \n\n        \n    end\n as bail_effet_mois,\n        \n    case \n        when surface_mode_code in ('NA', '0','NC','Z') or surface_mode_code is null \n            then 'N/A'\n        else surface_mode_code\n    end\n as surface_mode_code,\n        surface_mode_m2,\n        \n  \n  case\n    when try_cast(trim(replace(loyer_principal_mensuel_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(loyer_principal_mensuel_montant, ',', '.')) as float)\n    else null\n  end\n as loyer_principal_mensuel_montant,\n        \n  \n  case\n    when try_cast(trim(replace(loyer_accessoire_mensuel_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(loyer_accessoire_mensuel_montant, ',', '.')) as float)\n    else null\n  end\n as loyer_accessoire_mensuel_montant,\n        \n  \n  case\n    when try_cast(trim(replace(contribution_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(contribution_montant, ',', '.')) as float)\n    else null\n  end\n as contribution_montant,\n        financement_cus_code,\n        \n    case\n        when dpe_mois is null or trim(dpe_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(dpe_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(dpe_mois)) != 7 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(dpe_mois, '/', '-')), 4, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(dpe_mois, '/', '-')), 1, 2), '-',  -- MM\n                '01'                                                               -- JJ (par d\u00e9faut)\n            ) AS DATE\n        )\n \n\n        \n    end\n  as dpe_mois,\n        \n    case \n        when dpe_energie_code in ('NA', '0','NC','Z') or dpe_energie_code is null \n            then 'N/A'\n        else dpe_energie_code\n    end\n as dpe_energie_code,\n        \n    case \n        when dpe_ges_code in ('NA', '0','NC','Z') or dpe_ges_code is null \n            then 'N/A'\n        else dpe_ges_code\n    end\n as dpe_ges_code,\n        case when  region_code in ('01', '02', '03', '04', '06')  then null else \n    case\n        when sru_expiration_annee is null or trim(sru_expiration_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(sru_expiration_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(sru_expiration_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(sru_expiration_annee + '-01-01' AS DATE)\n        \n        \n    end\n end as sru_expiration_annee,\n        sru_alinea_code,\n        organisme_gestionnaire_id,\n        patrimoine_segment_code,\n        patrimoine_segment_libelle,\n        \n  \n  case\n    when try_cast(trim(replace(loyer_maximal_apl_mensuel_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(loyer_maximal_apl_mensuel_montant, ',', '.')) as float)\n    else null\n  end\n as loyer_maximal_apl_mensuel_montant,\n        \n  \n  case\n    when try_cast(trim(replace(loyer_maximal_cus_mensuel_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(loyer_maximal_cus_mensuel_montant, ',', '.')) as float)\n    else null\n  end\n as loyer_maximal_cus_mensuel_montant,\n        \n    case \n        when vente_type_code in ('NA', '0','NC','Z') or vente_type_code is null \n            then 'N/A'\n        else vente_type_code\n    end\n as vente_type_code,\n        mise_en_commercialisation_code,\n        \n  \n  case\n    when try_cast(trim(replace(vente_prix_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(vente_prix_montant, ',', '.')) as float)\n    else null\n  end\n as vente_prix_montant,\n        \n  \n  case\n    when try_cast(trim(replace(produit_financier_net_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(produit_financier_net_montant, ',', '.')) as float)\n    else null\n  end\n as produit_financier_net_montant,\n        \n    case\n        when remise_en_location_mois is null or trim(remise_en_location_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(remise_en_location_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(remise_en_location_mois)) != 7 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(remise_en_location_mois, '/', '-')), 4, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(remise_en_location_mois, '/', '-')), 1, 2), '-',  -- MM\n                '01'                                                               -- JJ (par d\u00e9faut)\n            ) AS DATE\n        )\n \n\n        \n    end\n as remise_en_location_mois,\n        reservation_contingent_code,\n        \n    case \n        when pmr_code in ('NA', '0','NC','Z') or pmr_code is null \n            then 'N/A'\n        else pmr_code\n    end\n as pmr_code,\n        \n    case\n        when vente_autorisation_mois is null or trim(vente_autorisation_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(vente_autorisation_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(vente_autorisation_mois)) != 7 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(vente_autorisation_mois, '/', '-')), 4, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(vente_autorisation_mois, '/', '-')), 1, 2), '-',  -- MM\n                '01'                                                               -- JJ (par d\u00e9faut)\n            ) AS DATE\n        )\n \n\n        \n    end\n as vente_autorisation_mois,\n        \n    case\n        when vente_effective_mois is null or trim(vente_effective_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(vente_effective_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(vente_effective_mois)) != 7 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(vente_effective_mois, '/', '-')), 4, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(vente_effective_mois, '/', '-')), 1, 2), '-',  -- MM\n                '01'                                                               -- JJ (par d\u00e9faut)\n            ) AS DATE\n        )\n \n\n        \n    end\n as vente_effective_mois,\n        \n    case\n        when locataire_dernier_depart_date is null or trim(locataire_dernier_depart_date) = '' then CAST(NULL AS DATE)\n        when upper(trim(locataire_dernier_depart_date)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(locataire_dernier_depart_date)) < 10 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(locataire_dernier_depart_date, '/', '-')), 7, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(locataire_dernier_depart_date, '/', '-')), 4, 2), '-',  -- MM\n                SUBSTRING(trim(REPLACE(locataire_dernier_depart_date, '/', '-')), 1, 2)        -- JJ\n            ) AS DATE\n        )\n    \n    end\n as locataire_dernier_depart_date,\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when dpe_energie_consommation_valeur is null \n          or dpe_energie_consommation_valeur in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(dpe_energie_consommation_valeur as integer) is not null \n        then cast(dpe_energie_consommation_valeur as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(dpe_energie_consommation_valeur as float) is not null \n        then cast(cast(dpe_energie_consommation_valeur as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as dpe_energie_consommation_valeur,\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when dpe_ges_consommation_valeur is null \n          or dpe_ges_consommation_valeur in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(dpe_ges_consommation_valeur as integer) is not null \n        then cast(dpe_ges_consommation_valeur as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(dpe_ges_consommation_valeur as float) is not null \n        then cast(cast(dpe_ges_consommation_valeur as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as dpe_ges_consommation_valeur,\n        dpe_reference_num,\n        logement_fiscal_id,\n        organisme_categorie_code,\n        organisme_raison_sociale_libelle,\n        RIGHT('00000000000000' + organisme_siret_code, 14) as organisme_siret_code,\n        departement_code,\n        departement_libelle,\n        region_code,\n        region_libelle,\n        epci_code,\n        epci_libelle,\n        departements_epci_list,\n        regions_epci_list,\n        var_financement_groupe_libelle,\n        var_mise_en_service_flag,\n        \n  \n  case\n    when try_cast(trim(replace(var_loyer_moyen_mensuel_m2_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(var_loyer_moyen_mensuel_m2_montant, ',', '.')) as float)\n    else null\n  end\n as var_loyer_moyen_mensuel_m2_montant,\n        var_logement_anciennete_en_annee,\n        var_deconventionnement_flag,\n        \n    case\n        when var_duree_vacance_mois is null or trim(var_duree_vacance_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_duree_vacance_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(var_duree_vacance_mois)) < 10 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(var_duree_vacance_mois, '/', '-')), 7, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(var_duree_vacance_mois, '/', '-')), 4, 2), '-',  -- MM\n                SUBSTRING(trim(REPLACE(var_duree_vacance_mois, '/', '-')), 1, 2)        -- JJ\n            ) AS DATE\n        )\n    \n    end\n  as var_duree_vacance_mois,\n        \n    case\n        when var_remise_en_location_annee is null or trim(var_remise_en_location_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_remise_en_location_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_remise_en_location_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(var_remise_en_location_annee + '-01-01' AS DATE)\n        \n        \n    end\n  as var_remise_en_location_annee,\n        \n    case\n        when var_remise_en_location_mois is null or trim(var_remise_en_location_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_remise_en_location_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(var_remise_en_location_mois)) < 10 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(var_remise_en_location_mois, '/', '-')), 7, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(var_remise_en_location_mois, '/', '-')), 4, 2), '-',  -- MM\n                SUBSTRING(trim(REPLACE(var_remise_en_location_mois, '/', '-')), 1, 2)        -- JJ\n            ) AS DATE\n        )\n    \n    end\n as var_remise_en_location_mois,\n        \n    case\n        when var_bail_effet_mois is null or trim(var_bail_effet_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_bail_effet_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(var_bail_effet_mois)) < 10 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(var_bail_effet_mois, '/', '-')), 7, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(var_bail_effet_mois, '/', '-')), 4, 2), '-',  -- MM\n                SUBSTRING(trim(REPLACE(var_bail_effet_mois, '/', '-')), 1, 2)        -- JJ\n            ) AS DATE\n        )\n    \n    end\n as var_bail_effet_mois,\n        \n    case\n        when var_bail_effet_annee is null or trim(var_bail_effet_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_bail_effet_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_bail_effet_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(var_bail_effet_annee + '-01-01' AS DATE)\n        \n        \n    end\n as var_bail_effet_annee,\n        \n    case\n        when var_bail_effet_date is null or trim(var_bail_effet_date) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_bail_effet_date)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(var_bail_effet_date)) < 10 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(var_bail_effet_date, '/', '-')), 7, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(var_bail_effet_date, '/', '-')), 4, 2), '-',  -- MM\n                SUBSTRING(trim(REPLACE(var_bail_effet_date, '/', '-')), 1, 2)        -- JJ\n            ) AS DATE\n        )\n    \n    end\n as var_bail_effet_date,\n        \n    case\n        when var_remise_en_location_date is null or trim(var_remise_en_location_date) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_remise_en_location_date)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n        when len(trim(var_remise_en_location_date)) < 10 then CAST(NULL AS DATE)\n        else TRY_CAST(\n            CONCAT(\n                SUBSTRING(trim(REPLACE(var_remise_en_location_date, '/', '-')), 7, 4), '-',  -- AAAA\n                SUBSTRING(trim(REPLACE(var_remise_en_location_date, '/', '-')), 4, 2), '-',  -- MM\n                SUBSTRING(trim(REPLACE(var_remise_en_location_date, '/', '-')), 1, 2)        -- JJ\n            ) AS DATE\n        )\n    \n    end\n as var_remise_en_location_date\n\n    from\n        cte_rename_raw_sdes_rpls_logement\n),\n\n \ncte_finale as\n(\n    select \n        *\n        , cast(current_timestamp as datetime2(3)) as _meta_loaded_at\n\n    from cte_clean_and_type_raw_sdes_rpls_logement\n)\n     \n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_sdes_rpls_logement\"", "batch_results": null}], "elapsed_time": 144.5088427066803, "args": {"require_yaml_configuration_for_mf_time_spines": false, "version_check": true, "printer_width": 80, "favor_state": false, "profiles_dir": "C:\\Users\\slhuissier\\dbt-projects\\dbt_dataplatform", "log_format": "default", "which": "run", "log_level_file": "debug", "send_anonymous_usage_stats": true, "introspect": true, "print": true, "state_modified_compare_vars": false, "strict_mode": false, "require_nested_cumulative_type_params": false, "state_modified_compare_more_unrendered_values": false, "partial_parse": true, "static_parser": true, "macro_debugging": false, "partial_parse_file_diff": true, "require_explicit_package_overrides_for_builtin_materializations": true, "indirect_selection": "eager", "write_json": true, "invocation_command": "dbt run -s stg_sdes_rpls_logement", "empty": false, "log_format_file": "debug", "quiet": false, "project_dir": "C:\\Users\\slhuissier\\dbt-projects\\dbt_dataplatform", "select": ["stg_sdes_rpls_logement"], "exclude": [], "use_colors": true, "skip_nodes_if_on_run_start_fails": false, "log_level": "info", "log_path": "C:\\Users\\slhuissier\\dbt-projects\\dbt_dataplatform\\logs", "require_resource_names_without_spaces": false, "cache_selected_only": false, "vars": {}, "warn_error_options": {"include": [], "exclude": []}, "use_colors_file": true, "log_file_max_bytes": 10485760, "populate_cache": true, "require_batched_execution_for_custom_microbatch_strategy": false, "source_freshness_run_project_hooks": false, "defer": false, "show_resource_report": false}}