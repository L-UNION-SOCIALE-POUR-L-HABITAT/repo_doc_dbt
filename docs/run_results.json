<<<<<<< HEAD
{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.10", "generated_at": "2025-12-10T09:43:18.756068Z", "invocation_id": "144f3134-c2c6-4c0d-8fa1-233e82170699", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-10T09:41:41.534314Z", "completed_at": "2025-12-10T09:41:41.558851Z"}, {"name": "execute", "started_at": "2025-12-10T09:41:41.560613Z", "completed_at": "2025-12-10T09:43:18.746757Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 97.2141981124878, "adapter_response": {"_message": "OK", "rows_affected": -1}, "message": "OK", "failures": null, "unique_id": "model.dbt_dataplatform.fait_parc_social_annee", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table de fait parc social\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_logement_rpls\n * Cible :          logement_rpls  \n\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n \ncte_logement_rpls as\n(\n    select\n        logement_rpls_hk\n        -- ANNEE\n        ,logement_rpls_millesime_date   \n        ,construction_anciennete_en_annee \n        ,construction_achevement_annee \n        -- FLAG\n        ,qpv_flag\n        ,mise_en_service_flag\n        ,sem_non_convention_flag\n        ,logement_loyer_libre_flag\n        ,bail_effet_annee_prec_flag\n        ,bail_fin_annee_prec_flag\n        ,emmenagement_flag\n        -- SURFACE\n        ,surface_habitable_m2\n        -- MONTANT\n        ,loyer_principal_mensuel_montant\n        -- CODE\n        ,piece_nombre_code\n        ,dpe_energie_code\n        ,dpe_ges_code\n        ,patrimoine_sortie_code     as patrimoine_sortie_code_source\n        ,vente_type_code      \n        ,commune_code               as commune_code_source\n        ,organisme_famille_rpls_code\n        ,financement_groupe_code\n        ,occupation_mode_code\n        ,construction_type_code\n        ,patrimoine_origine_code\n        ,pmr_code                    \n        -- HK\n        ,financement_groupe_hk\n        ,patrimoine_origine_hk\n        ,dpe_ges_hk\n        ,dpe_energie_hk    \n        ,occupation_mode_hk  \n        ,construction_type_hk   \n        ,organisme_famille_hk\n        ,piece_nombre_hk\n        ,pmr_hk                      \n         \n\n    from\n        \"wh_dp_silver\".\"dbo\".\"logement_rpls\"\n\n),\n\ncte_map_patrimoine_sortie as \n(\n    select\n        patrimoine_sortie_code_silver\n        , vente_type_code_silver\n        , patrimoine_sortie_code_gold\n        , patrimoine_sortie_gold_libelle\n\n    from    \n        \"wh_dp_bronze\".\"seed\".\"map_patrimoine_sortie\"\n),\n\ncte_passage_commune_histo as\n(\n    select \n        passage_commune_annee\n        , passage_commune_annee_last_flag\n        , commune_initiale_code\n        , commune_finale_code\n    from\n        \"wh_dp_silver\".\"dbo\".\"passage_commune_histo\"\n),\n\n-- la dimension commune contient la derni\u00e8re version  \ncte_commune as \n(\n    select \n        commune_annee,\n        commune_code,\n        commune_hk,\n        departement_code,\n        departement_hk,\n        epci_code,\n        epci_hk,\n        ept_code,\n        ept_hk,\n        zone_123_code,\n        zone_123_hk,\n        zone_abc_code,\n        zone_abc_hk\n    from \n        \"wh_dp_gold\".\"dbo\".\"dim_commune\"\n),\n\n-- la dimension departement contient la derni\u00e8re version  \ncte_departement as \n(\n    select \n        departement_hk, \n        region_hk,\n        region_code\n    from \n        \"wh_dp_gold\".\"dbo\".\"dim_departement\"\n),\n\n-- la dimension region contient la derni\u00e8re version\ncte_region as\n(\n    select \n        region_hk,\n        region_outre_mer_flag\n     from \n        \"wh_dp_gold\".\"dbo\".\"dim_region\"\n),\n\n\ncte_ref_dataplatform as\n(\n    select \n        \n        objet\n        , code \n        , val1\n        , val2\n    from \n        \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n\n),\n-------------------------------------------------------------------\n--*************************** FILTRES *****************************\n-------------------------------------------------------------------\n\n --recuperation de la derni\u00e8re version des passages communes\n cte_passage_commune_histo_last as\n (\n    select\n        *\n    from cte_passage_commune_histo\n    where \n        passage_commune_annee_last_flag = 1\n       \n ),\n\n \ncte_dim_construction_periode as \n(\n    select \n        code\n        , val1\n        , val2\n    from \n        cte_ref_dataplatform\n    where \n        objet = 'dim_construction_periode'\n\n),\n\n\n\n-------------------------------------------------------------------\n--************************* TRAITEMENTS ***************************\n-------------------------------------------------------------------\n\n cte_commune_fusionnee as\n(\nselect  commune_initiale_code,\n        commune_finale_code\nfrom  cte_passage_commune_histo_last base\nwhere not exists (select 1 \n      \n      from cte_passage_commune_histo_last cte_passage_commune_histo\n      where\n           base.commune_initiale_code = cte_passage_commune_histo.commune_finale_code\n            )\n),\n\n-- Pr\u00e9paration des axes d'analyses\ncte_transform_logement_rpls as\n(\n    select\n        cte_logement_rpls.*\n        -- R\u00e8gle de d\u00e9termination du code commune :\n        -- 1. Si le code commune du RPLS est pr\u00e9sent dans le champ \"commune_finale\" de la table de passage,\n        --    alors on conserve ce code (le code n\u2019a pas chang\u00e9, ex : scission).\n        -- 2. Sinon, on recherche dans la table de passage la ligne o\u00f9 :\n        --       \"commune_initiale\" = code commune du RPLS,\n        --    et on r\u00e9cup\u00e8re le code \"commune_finale\" correspondant (le code a chang\u00e9, ex : fusion).\n        --\n        -- Autrement dit :\n        -- - En cas de **scission**, la commune garde son code d\u2019origine.\n        -- - En cas de **fusion**, la commune prend le nouveau code issu de la table de passage.\n        , case when exists (select 1 \n                            from  cte_logement_rpls   \n                            inner join cte_passage_commune_histo\n                            on (\n                                cte_logement_rpls.commune_code_source = cte_passage_commune_histo.commune_finale_code\n                                and  cte_passage_commune_histo.passage_commune_annee_last_flag = 1\n                            ))\n                    then cte_logement_rpls.commune_code_source  \n                else cte_commune_fusionnee.commune_initiale_code  \n        end as commune_code\n        , isnull(cte_map_patrimoine_sortie.patrimoine_sortie_code_gold, 'N/A')   as patrimoine_sortie_code\n        , isnull(cte_dim_construction_periode.code, 'N/A')                       as construction_periode_code\n    from \n        cte_logement_rpls   \n    left join\n        cte_map_patrimoine_sortie on (\n            cte_logement_rpls.patrimoine_sortie_code_source = cte_map_patrimoine_sortie.patrimoine_sortie_code_silver\n            and (\n                cte_map_patrimoine_sortie.vente_type_code_silver = '-'\n                or\n                cte_logement_rpls.vente_type_code = cte_map_patrimoine_sortie.vente_type_code_silver \n                )\n                                            \n        )\n     left join \n        cte_dim_construction_periode on (\n            year(cte_logement_rpls.construction_achevement_annee) between cte_dim_construction_periode.val1 and cte_dim_construction_periode.val2\n\n        )\n    left join \n    cte_commune_fusionnee as cte_commune_fusionnee on (     \n        cte_logement_rpls.commune_code_source =   cte_commune_fusionnee.commune_initiale_code\n        \n    )\n    \n\n),\n\n-- On ajoute les informations de la commune\ncte_infos_commune_logement_rpls as\n(\n    select \n        cte_transform_logement_rpls.*\n        , cte_commune.commune_annee as geographie_annee\n        , cte_commune.commune_hk\n        , cte_commune.departement_code\n        , cte_commune.departement_hk\n        , cte_commune.epci_code\n        , cte_commune.epci_hk\n        , cte_commune.ept_code\n        , cte_commune.ept_hk\n        , cte_departement.region_code\n        , cte_departement.region_hk\n        , cte_region.region_outre_mer_flag\n        , cte_commune.zone_123_code\n        , cte_commune.zone_123_hk\n        , cte_commune.zone_abc_code\n        , cte_commune.zone_abc_hk\n \n    from \n        cte_transform_logement_rpls\n    inner join cte_commune\n    on (cte_transform_logement_rpls.commune_code = cte_commune.commune_code )\n    inner join cte_departement\n    on (cte_commune.departement_hk = cte_departement.departement_hk)\n    inner join cte_region\n    on (cte_departement.region_hk = cte_region.region_hk)\n),\n\n-- Exlusion des SEM non conventionn\u00e9es (except\u00e9 pour les DOM-TOM) et des logements \u00e0 loyer libre\ncte_filtre_logement_rpls as\n(\n    select \n        *\n    from\n        cte_infos_commune_logement_rpls\n    where \n        (\n            (sem_non_convention_flag <> 1 or region_outre_mer_flag = 1)\n            and\n            logement_loyer_libre_flag <> 1\n             \n\n        )\n        \n),\n \n-- Calcul des indicateurs et aggr\u00e9gation\n cte_calc_logement_rpls as \n (\n    select\n        logement_rpls_millesime_date                                            as rpls_annee\n        , commune_code \n        , departement_code\n        , region_code   \n        , epci_code\n        , ept_code\n        , zone_123_code\n        , zone_abc_code\n        , piece_nombre_code                                                      \n        , qpv_flag    \n        , bail_effet_annee_prec_flag        \n        , bail_fin_annee_prec_flag     \n        , emmenagement_flag\n        , mise_en_service_flag               \n        , financement_groupe_code\n        , dpe_energie_code\n        , dpe_ges_code\n        , patrimoine_origine_code\n        , construction_type_code\n        , occupation_mode_code\n        , patrimoine_sortie_code                                                                                                                                                    \n        , construction_periode_code   \n        , organisme_famille_rpls_code     \n        , pmr_code                                       \n        , sum(construction_anciennete_en_annee)                                 as construction_anciennete_en_annee\n        , count(logement_rpls_hk)                                               as logement_total_nombre\n        , sum(surface_habitable_m2)                                             as surface_habitable_m2\n        , sum(loyer_principal_mensuel_montant)                                  as loyer_principal_mensuel_montant\n        , dpe_energie_hk\n        , dpe_ges_hk\n        , commune_hk\n        , patrimoine_origine_hk\n        , construction_type_hk\n        , occupation_mode_hk \n        , financement_groupe_hk\n        , piece_nombre_hk\n        , organisme_famille_hk\n        , departement_hk\n        , region_hk  \n        , epci_hk\n        , ept_hk\n        , zone_123_hk\n        , zone_abc_hk\n        , pmr_hk\n    \n\n    from \n        cte_filtre_logement_rpls\n    \n    group by\n        logement_rpls_millesime_date                                                     \n        , commune_code \n        , departement_code\n        , region_code   \n        , epci_code\n        , ept_code\n        , zone_123_code\n        , zone_abc_code\n        , piece_nombre_code                                                      \n        , qpv_flag       \n        , bail_effet_annee_prec_flag        \n        , bail_fin_annee_prec_flag  \n        , emmenagement_flag\n        , mise_en_service_flag                                                 \n        , financement_groupe_code\n        , dpe_energie_code\n        , dpe_ges_code\n        , patrimoine_origine_code\n        , construction_type_code\n        , occupation_mode_code\n        , patrimoine_sortie_code                                                                                                                                                    \n        , construction_periode_code   \n        , organisme_famille_rpls_code\n        , pmr_code\n        , dpe_energie_hk\n        , dpe_ges_hk\n        , patrimoine_origine_hk\n        , construction_type_hk\n        , occupation_mode_hk \n        , financement_groupe_hk\n        , piece_nombre_hk\n        , organisme_famille_hk\n        , commune_hk\n        , departement_hk\n        , region_hk  \n        , epci_hk\n        , ept_hk\n        , zone_123_hk\n        , zone_abc_hk\n        , pmr_hk\n\n ),\n\n -- Calcul des cl\u00e9s techniques pour celles qui ne sont pas directement r\u00e9cup\u00e9r\u00e9es de la couche silver\ncte_hk_calc_logement_rpls as\n (\n    select     \n        cte_calc_logement_rpls.*\n\n    ,   \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(patrimoine_sortie_code as varchar(max))\n    \n)  \n \n    as patrimoine_sortie_hk\n    ,   \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(construction_periode_code as varchar(max))\n    \n)  \n \n as construction_periode_hk\n    from \n        cte_calc_logement_rpls\n ),\n        \n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n \ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_calc_logement_rpls\n)\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"fait_parc_social_annee\"", "batch_results": null}], "elapsed_time": 98.54462695121765, "args": {"require_resource_names_without_spaces": false, "printer_width": 80, "send_anonymous_usage_stats": true, "require_batched_execution_for_custom_microbatch_strategy": false, "project_dir": "C:\\Users\\slhuissier\\dbt-projects\\dbt_dataplatform", "require_nested_cumulative_type_params": false, "version_check": true, "indirect_selection": "eager", "populate_cache": true, "invocation_command": "dbt run -s fait_parc_social_annee", "log_path": "C:\\Users\\slhuissier\\dbt-projects\\dbt_dataplatform\\logs", "partial_parse_file_diff": true, "skip_nodes_if_on_run_start_fails": false, "source_freshness_run_project_hooks": false, "defer": false, "strict_mode": false, "partial_parse": true, "empty": false, "profiles_dir": "C:\\Users\\slhuissier\\dbt-projects\\dbt_dataplatform", "introspect": true, "use_colors": true, "write_json": true, "show_resource_report": false, "cache_selected_only": false, "log_format": "default", "require_yaml_configuration_for_mf_time_spines": false, "state_modified_compare_vars": false, "quiet": false, "static_parser": true, "log_file_max_bytes": 10485760, "use_colors_file": true, "log_format_file": "debug", "favor_state": false, "select": ["fait_parc_social_annee"], "require_explicit_package_overrides_for_builtin_materializations": true, "print": true, "warn_error_options": {"include": [], "exclude": []}, "which": "run", "log_level_file": "debug", "exclude": [], "state_modified_compare_more_unrendered_values": false, "vars": {}, "log_level": "info", "macro_debugging": false}}
=======
{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.13", "generated_at": "2025-12-09T16:58:44.272566Z", "invocation_id": "ae6d41da-4be5-4dec-889e-4321d8841221", "invocation_started_at": "2025-12-09T16:58:31.585729Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T16:58:34.327946Z", "completed_at": "2025-12-09T16:58:34.335100Z"}, {"name": "execute", "started_at": "2025-12-09T16:58:34.335492Z", "completed_at": "2025-12-09T16:58:36.446930Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.12027907371521, "adapter_response": {"_message": "OK", "rows_affected": -1}, "message": "OK", "failures": null, "unique_id": "model.dbt_dataplatform.stg_crm_entreprise", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_crm_entreprise\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          raw_crm_entreprise\n * Cible :          stg_crm_entreprise\n *test\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_entreprise as \n (\n    select \n        [codeUnion]             as organisme_code_union,\n        [name]                  as organisme_raison_sociale_libelle,\n        [organizationStatut]    as organisme_statut_code,\n        [organizationType]      as organisme_type_code,\n        [siren]                 as organisme_siren_code,\n        [subfamily]             as organisme_sous_famille_code,\n        [id]                    as organisme_id_code\n      \n    from   \"wh_dp_bronze\".\"raw\".\"raw_crm_entreprise\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_entreprise as \n (\n    select\n        *\n       \n    from  cte_rename_raw_entreprise\n ),\n \n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\ncte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_entreprise\n)\n \n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_crm_entreprise\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T16:58:36.452916Z", "completed_at": "2025-12-09T16:58:36.457605Z"}, {"name": "execute", "started_at": "2025-12-09T16:58:36.458135Z", "completed_at": "2025-12-09T16:58:37.855436Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.4037659168243408, "adapter_response": {"_message": "OK", "rows_affected": -1}, "message": "OK", "failures": null, "unique_id": "model.dbt_dataplatform.stg_crm_personne", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_crm_personne\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          raw_crm_personne\n * Cible :          stg_crm_personne\n *test\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_personne as \n (\n    select \n        [PerID]                  as personne_id_code,\n        [PerCivID]               as personne_civilite_id_code,\n        [EntOrgType]             as organisme_type_code,\n        [EntOrgTypeLabel]        as organisme_type_libelle,\n        [PerEntID]               as organisme_id_code,\n        [EntCodeUnion]           as organisme_code_union,\n        [EntSiren]               as organisme_siren_code,\n        [PerLdapName_]           as personne_ldap_code,\n        [PerFstName]             as personne_prenom_libelle,\n        [PerName]                as personne_nom_libelle,\n        [PerTitle]               as personne_titre_libelle,\n        [PerFctID]               as personne_fonction_code,\n        [PerFctLabel]            as personne_fonction_libelle,\n        [PerMail]                as personne_email_libelle,\n        [PerDataPrivStatus]      as personne_statut_code,\n        [PerRolesApplication1_]  as personne_role_libelle\n\n\n    from   \"wh_dp_bronze\".\"raw\".\"raw_crm_personne\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_personne as \n (\n    select\n        *\n       \n    from  cte_rename_raw_personne\n ),\n \n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\ncte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_personne\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_crm_personne\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T16:58:37.860924Z", "completed_at": "2025-12-09T16:58:37.866088Z"}, {"name": "execute", "started_at": "2025-12-09T16:58:37.866455Z", "completed_at": "2025-12-09T16:58:39.677055Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.8171663284301758, "adapter_response": {"_message": "OK", "rows_affected": -1}, "message": "OK", "failures": null, "unique_id": "model.dbt_dataplatform.int_organisme", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_organisme\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          stg_crm_entreprise\n * Cible :          int_organisme\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_entreprise as \n(\n    select \n        organisme_raison_sociale_libelle,\n        organisme_statut_code,\n        organisme_type_code,\n        organisme_siren_code,\n        coalesce(organisme_sous_famille_code,'N/A') as organisme_sous_famille_code, \n        organisme_code_union,\n        organisme_id_code\n        \n    from \n        \"wh_dp_silver\".\"stg\".\"stg_crm_entreprise\"\n),\n/*\ncte_stg_reference as\n(\n\n),\n\ncte_stg_orfi_group as \n(\n\n)\n*/\n\n \n-------------------------------------------------------------------\n--************************** FILTRAGE ****************************\n-------------------------------------------------------------------\n-- on souhaite recueperer que les organismes actifs\ncte_filter_stg_entreprise as \n(\n    select \n        *\n        \n    from \n        cte_stg_entreprise\n\n    where organisme_statut_code = 'ACT'\n        and organisme_code_union IS NOT NULL\n),\n\n-------------------------------------------------------------------\n--************* JOINTURE ET COLONNES CALCULEES ********************\n-------------------------------------------------------------------\ncte_calc_stg_entreprise  as \n (\n    select\n        *\n    \n    from cte_filter_stg_entreprise\n\n    --left join cte_stg_reference on ....\n    --left join cte_stg_orfi_group on ....\n ),\n\n\n-------------------------------------------------------------------\n--********************** CLES TECHNIQUES *************************\n-------------------------------------------------------------------\ncte_hk_calc_stg_entreprise as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_code_union as varchar(max))\n    \n)  \n \n         as organisme_code_union_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_statut_code as varchar(max))\n    \n)  \n \n       as organisme_statut_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_type_code as varchar(max))\n    \n)  \n \n         as organisme_type_code_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_sous_famille_code as varchar(max))\n    \n)  \n \n  as organisme_sous_famille_hk\n         \n    from \n        cte_calc_stg_entreprise\n),\n \n-------------------------------------------------------------------\n--********************** ETAPE FINALE *************************\n-------------------------------------------------------------------\n \n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_stg_entreprise\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_organisme\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T16:58:39.681082Z", "completed_at": "2025-12-09T16:58:39.686156Z"}, {"name": "execute", "started_at": "2025-12-09T16:58:39.686532Z", "completed_at": "2025-12-09T16:58:41.410553Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.7305636405944824, "adapter_response": {"_message": "OK", "rows_affected": -1}, "message": "OK", "failures": null, "unique_id": "model.dbt_dataplatform.int_personne", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_organisme\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          stg_crm_entreprise\n * Cible :          int_organisme\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_personne as \n(\n    select \n        personne_id_code,\n        organisme_type_code,\n        organisme_type_libelle,\n        organisme_siren_code,\n        organisme_code_union,\n        organisme_id_code,\n        personne_ldap_code,\n        personne_prenom_libelle,\n        personne_nom_libelle,\n        personne_titre_libelle,\n        personne_fonction_code,\n        personne_fonction_libelle,\n        personne_email_libelle,\n        personne_statut_code,\n        personne_role_libelle\n\n\n    from \n        \"wh_dp_silver\".\"stg\".\"stg_crm_personne\"\n),\n\n\n\n\n/*\ncte_stg_reference as\n(\n\n),\n\ncte_stg_orfi_group as \n(\n\n)\n*/\n\n \n-------------------------------------------------------------------\n--************************** FILTRAGE ****************************\n-------------------------------------------------------------------\n-- on souhaite recueperer que les organismes actifs\ncte_filter_stg_personne as \n(\n    select \n        *\n        \n    from \n        cte_stg_personne\n\n    where personne_statut_code = 'Active'\n        and personne_ldap_code IS NOT NULL\n),\n\n-------------------------------------------------------------------\n--************* JOINTURE ET COLONNES CALCULEES ********************\n-------------------------------------------------------------------\ncte_calc_stg_personne  as \n (\n    select\n        personne_id_code,\n        organisme_type_code,\n        organisme_type_libelle,\n        organisme_siren_code,\n        organisme_code_union,\n        organisme_id_code,\n        coalesce(personne_ldap_code,'N/A') as personne_ldap_code, \n        personne_prenom_libelle,\n        personne_nom_libelle,\n        personne_titre_libelle,\n        personne_fonction_code,\n        personne_fonction_libelle,\n        personne_email_libelle,\n        personne_statut_code,\n        personne_role_libelle\n    \n    from cte_filter_stg_personne\n    --left join cte_stg_reference on ....\n    --left join cte_stg_orfi_group on ....\n ),\n\n\n-------------------------------------------------------------------\n--********************** CLES TECHNIQUES *************************\n-------------------------------------------------------------------\ncte_hk_calc_stg_personne as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(personne_ldap_code as varchar(max))\n    \n)  \n \n           as personne_ldap_code_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_code_union as varchar(max))\n    \n)  \n \n         as organisme_code_union_hk\n         \n    from \n        cte_calc_stg_personne\n),\n \n-------------------------------------------------------------------\n--********************** ETAPE FINALE *************************\n-------------------------------------------------------------------\n \n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_stg_personne\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_personne\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T16:58:41.416456Z", "completed_at": "2025-12-09T16:58:41.420841Z"}, {"name": "execute", "started_at": "2025-12-09T16:58:41.421404Z", "completed_at": "2025-12-09T16:58:42.737193Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.322380781173706, "adapter_response": {"_message": "OK", "rows_affected": -1}, "message": "OK", "failures": null, "unique_id": "model.dbt_dataplatform.organisme", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table organisme\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          int_organisme\n * Cible :          organisme\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_organisme as\n(\n    select\n        organisme_code_union_hk,\n        organisme_code_union,\n        organisme_raison_sociale_libelle,\n        organisme_statut_hk,\n        organisme_statut_code,\n        organisme_type_code_hk,\n        organisme_type_code,\n        organisme_siren_code,\n        organisme_sous_famille_hk,\n        organisme_sous_famille_code,\n        organisme_id_code\n\n    from \"wh_dp_silver\".\"int\".\"int_organisme\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    \n    from cte_int_organisme\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbi\".\"organisme\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T16:58:42.742248Z", "completed_at": "2025-12-09T16:58:42.746416Z"}, {"name": "execute", "started_at": "2025-12-09T16:58:42.746783Z", "completed_at": "2025-12-09T16:58:44.265109Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.524052381515503, "adapter_response": {"_message": "OK", "rows_affected": -1}, "message": "OK", "failures": null, "unique_id": "model.dbt_dataplatform.personne", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table personne\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          int_organisme\n * Cible :          organisme\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_personne as\n(\n    select\n        personne_id_code,\n        personne_ldap_code_hk,\n        personne_ldap_code,\n        organisme_type_code,\n        organisme_type_libelle,\n        organisme_siren_code,\n        organisme_code_union_hk,\n        organisme_code_union,\n        organisme_id_code,\n        personne_prenom_libelle,\n        personne_nom_libelle,\n        personne_titre_libelle,\n        personne_fonction_code,\n        personne_fonction_libelle,\n        personne_email_libelle,\n        personne_statut_code,\n        personne_role_libelle\n\n    from \"wh_dp_silver\".\"int\".\"int_personne\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    \n    from cte_int_personne\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbi\".\"personne\"", "batch_results": null}], "elapsed_time": 11.059332132339478, "args": {"require_yaml_configuration_for_mf_time_spines": false, "print": true, "empty": false, "cache_selected_only": false, "use_fast_test_edges": false, "quiet": false, "invocation_command": "dbt run -s tag:annuaire", "log_file_max_bytes": 10485760, "partial_parse_file_diff": true, "skip_nodes_if_on_run_start_fails": false, "send_anonymous_usage_stats": true, "require_batched_execution_for_custom_microbatch_strategy": false, "favor_state": false, "show_all_deprecations": false, "log_format": "default", "require_resource_names_without_spaces": true, "state_modified_compare_vars": false, "validate_macro_args": false, "macro_debugging": false, "vars": {}, "use_colors": true, "static_parser": true, "write_json": true, "log_path": "C:\\Users\\nitissier\\dbt_projects\\dbt_dataplatform\\logs", "printer_width": 80, "require_all_warnings_handled_by_warn_error": false, "require_generic_test_arguments_property": true, "use_colors_file": true, "which": "run", "strict_mode": false, "introspect": true, "require_explicit_package_overrides_for_builtin_materializations": true, "require_nested_cumulative_type_params": false, "log_level": "info", "populate_cache": true, "select": ["tag:annuaire"], "log_level_file": "debug", "state_modified_compare_more_unrendered_values": false, "log_format_file": "debug", "source_freshness_run_project_hooks": true, "profiles_dir": "C:\\Users\\nitissier\\dbt_projects\\dbt_dataplatform", "upload_to_artifacts_ingest_api": false, "project_dir": "C:\\Users\\nitissier\\dbt_projects\\dbt_dataplatform", "version_check": true, "indirect_selection": "eager", "exclude": [], "warn_error_options": {"error": [], "warn": [], "silence": []}, "partial_parse": true, "show_resource_report": false, "defer": false}}
>>>>>>> develop
