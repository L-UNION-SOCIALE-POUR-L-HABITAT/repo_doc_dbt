{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.13", "generated_at": "2025-11-18T13:40:04.088624Z", "invocation_id": "5fe8edb8-f1c2-4076-9584-817c650f6df4", "invocation_started_at": "2025-11-18T13:39:54.624816Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.859685Z", "completed_at": "2025-11-18T13:40:02.874616Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.875152Z", "completed_at": "2025-11-18T13:40:02.875165Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.016199111938476562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_calendrier", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table int_calendrier\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source :         Ann\u00e9es comprise entre 1900 et 2050\n * Cible :          int_calendrier\n */\n\n\n\nwith\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\ncte_min_max_annee as (\n    select \n        1900 as min_annee,\n        2050 as max_annee\n),\n\n-------------------------------------------------------------------\n--************ GENERATION DE TOUTES LES DATES *********************\n-------------------------------------------------------------------\n-- On utilise GENERATE_SERIES (alias SEQUENCE en Fabric SQL) \n-- pour g\u00e9n\u00e9rer toutes les dates entre 01-01-min et 31-12-max\ncte_all_dates as (\n    select\n        dte = dateadd(day, value, cast(cast(min_annee as varchar) + '-01-01' as date))\n    from cte_min_max_annee\n    cross apply generate_series(\n        0,\n        datediff(\n            day,\n            cast(cast(min_annee as varchar) + '-01-01' as date),\n            cast(cast(max_annee as varchar) + '-12-31' as date)\n        ),\n        1\n    )\n)\n\n-------------------------------------------------------------------\n--*********************** TABLE EN SORTIE *************************\n-------------------------------------------------------------------\nselect\n    dte                                             as date_iso,\n    cast(FORMAT(dte, 'dd-MM-yyyy') as varchar(10))  as date_fr_char,\n    year(dte)                                       as date_annee_int,\n    cast(FORMAT(dte, 'yyyy') as varchar(4))         as date_annee_char,\n    month(dte)                                      as date_mois_int,\n    cast(FORMAT(dte, 'MM') as varchar(2))           as date_mois_char,\n    day(dte)                                        as date_jour_int,\n    cast(FORMAT(dte, 'dd') as varchar(2))           as date_jour_char\n    \nfrom cte_all_dates", "relation_name": "\"wh_dp_silver\".\"int\".\"int_calendrier\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.876743Z", "completed_at": "2025-11-18T13:40:02.885266Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.885725Z", "completed_at": "2025-11-18T13:40:02.885733Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009698152542114258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_crm_entreprise", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_crm_entreprise\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          raw_crm_entreprise\n * Cible :          stg_crm_entreprise\n *test\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_entreprise as \n (\n    select \n        [name]                  as organisme_raison_sociale_libelle,\n        [organizationStatut]    as organisme_statut_code,\n        [organizationType]      as organisme_type_code,\n        [siren]                 as organisme_siren_code,\n        --[status],\n        [subfamily]             as organisme_sous_famille_code,\n        [codeUnion]             as organisme_code_union,\n        [id]                    as organisme_id_code\n      \n    from   \"wh_dp_bronze\".\"raw\".\"raw_crm_entreprise\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_entreprise as \n (\n    select\n        *\n       \n    from  cte_rename_raw_entreprise\n ),\n \n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\ncte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_entreprise\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_crm_entreprise\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.887975Z", "completed_at": "2025-11-18T13:40:02.896881Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.897329Z", "completed_at": "2025-11-18T13:40:02.897335Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010845661163330078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_crm_personne", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_crm_personne\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          raw_crm_personne\n * Cible :          stg_crm_personne\n *test\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_personne as \n (\n    select \n        [PerID]                  as personne_id_code,\n        [PerCivID]               as personne_civilite_hk,\n        [EntOrgType]             as organisme_type_code,\n        [EntOrgTypeLabel]        as organisme_type_libelle,\n        [PerEntID]               as organisme_id_code,\n        [EntCodeUnion]           as organisme_code_union,\n        [EntSiren]               as organisme_siren_code,\n        [PerLdapName_]           as personne_ldap_code,\n        [PerFstName]             as personne_prenom_libelle,\n        [PerName]                as personne_nom_libelle,\n        [PerTitle]               as personne_titre_libelle,\n        [PerFctID]               as personne_fonction_code,\n        [PerFctLabel]            as personne_fonction_libelle,\n        [PerMail]                as personne_email_libelle,\n        [PerDataPrivStatus]      as personne_statut_code,\n        [PerRolesApplication1_]  as personne_role_libelle\n\n\n    from   \"wh_dp_bronze\".\"raw\".\"raw_crm_personne\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_personne as \n (\n    select\n        *\n       \n    from  cte_rename_raw_personne\n ),\n \n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\ncte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_personne\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_crm_personne\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.899384Z", "completed_at": "2025-11-18T13:40:02.909227Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.909694Z", "completed_at": "2025-11-18T13:40:02.909701Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011311054229736328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_insee_appartenance_geo_commune", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_insee_appartenance_geo_commune\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_insee_appartenance_geo_commune\n * Cible :          stg_insee_appartenance_geo_commune\n */\n\n\n\n\n with\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_insee_appartenance_geo_commune as \n (\n    select\n        [_meta_year]             as commune_annee,\n        [CODGEO]                 as commune_code,\n        [LIBGEO]                 as commune_libelle,\n        [DEP]                    as departement_code,\n        --[CTCD],\n        [REG]                    as region_code,\n        [EPCI]                   as epci_code,\n        [EPT]                    as ept_code\n        --[ARR]\n        --[CANOV],\n        --[ZE2020],\n        --[UU2020],\n        --[AAV2020],\n        --[BV2022]\n\n    from\n        \"wh_dp_bronze\".\"raw\".\"raw_insee_appartenance_geo_commune\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_insee_appartenance_geo_commune as \n (\n    select\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when commune_annee is null \n          or commune_annee in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(commune_annee as integer) is not null \n        then cast(commune_annee as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(commune_annee as float) is not null \n        then cast(cast(commune_annee as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as commune_annee,\n        commune_code,\n        commune_libelle,\n        departement_code,\n        region_code,\n        epci_code,\n        ept_code\n\n    from  cte_rename_raw_insee_appartenance_geo_commune\n ),\n \ncte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_insee_appartenance_geo_commune\n)\n\n     \n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_commune\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.911691Z", "completed_at": "2025-11-18T13:40:02.920069Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.920551Z", "completed_at": "2025-11-18T13:40:02.920559Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009618282318115234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_insee_appartenance_geo_iris", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_insee_appartenance_geo_iris\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Full refresh / overwrite\n * Source:          raw_insee_appartenance_geo_iris\n * Cible :          stg_insee_appartenance_geo_iris \n * DEPCOM & LIBCOM sont soit un arrondissement , soit une commune\n */\n\n\n\nwith\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_insee_appartenance_geo_iris as \n (\n    select \n        [_meta_year]    as quartier_iris_annee,\n        [CODE_IRIS]     as quartier_iris_code,\n        [LIB_IRIS]      as quartier_iris_libelle,\n        [TYP_IRIS]      as quartier_iris_type_code,\n        --[GRD_QUART],\n        [DEPCOM]        as geographie_code,\n        [LIBCOM]        as geographie_libelle \n        --[UU2020],\n        --[REG],\n        --[DEP]\n         \n    from   \"wh_dp_bronze\".\"raw\".\"raw_insee_appartenance_geo_iris\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\n\ncte_clean_and_type_raw_insee_appartenance_geo_iris as \n (\n    select\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when quartier_iris_annee is null \n          or quartier_iris_annee in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(quartier_iris_annee as integer) is not null \n        then cast(quartier_iris_annee as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(quartier_iris_annee as float) is not null \n        then cast(cast(quartier_iris_annee as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as quartier_iris_annee,\n        quartier_iris_code ,\n        quartier_iris_libelle ,       \n        geographie_code ,\n        geographie_libelle \n              \n    from   cte_rename_insee_appartenance_geo_iris\n ),\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n------------------------------------------------------------------- \n cte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_insee_appartenance_geo_iris\n)\n\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_iris\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.921958Z", "completed_at": "2025-11-18T13:40:02.938350Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.938814Z", "completed_at": "2025-11-18T13:40:02.938820Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.017503738403320312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_insee_appartenance_geo_qpv24", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_insee_appartenance_geo_qpv24\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_insee_appartenance_geo_qpv24\n * Cible :          stg_insee_appartenance_geo_qpv24 \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_insee_appartenance_geo_qpv24 as \n (\n    select \n        [_meta_year]        as qpv_commune_annee ,\n        [QP]                as qpv_code ,\n        [LIB_QP]            as qpv_libelle ,       \n        [LIST_COM]          as commune_code_liste ,\n        [LIST_LIB_COM]      as commune_libelle_liste ,\n        [LIST_COMARR]       as arrondissement_code_liste ,\n        [LIST_LIB_COMARR]   as arrondissement_libelle_liste\n        -- [ZONE_EPCI_1],\n        -- [ZONE_EPCI_2],\n        -- [LIST_ZONE_EPCI],\n        -- [LIST_LIB_ZONE_EPCI],\n        -- [REG],\n        -- [DEP],\n        -- [UU2020],\n        -- [FUSION_COM_2324],\n        -- [LISTE_COM_MODIF_2324],\n        -- [FUSION_EPCI_2324],\n        -- [LISTE_EPCI_MODIF_2324],\n      \n    from   \"wh_dp_bronze\".\"raw\".\"raw_insee_appartenance_geo_qpv24\"\n ),\n\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\n\ncte_clean_and_type_raw_insee_appartenance_geo_qpv24 as \n (\n    select\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when qpv_commune_annee is null \n          or qpv_commune_annee in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(qpv_commune_annee as integer) is not null \n        then cast(qpv_commune_annee as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(qpv_commune_annee as float) is not null \n        then cast(cast(qpv_commune_annee as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as qpv_commune_annee,\n        qpv_code ,\n        qpv_libelle ,       \n        commune_code_liste ,\n        commune_libelle_liste ,\n        arrondissement_code_liste ,\n        arrondissement_libelle_liste\n      \n    from   cte_rename_insee_appartenance_geo_qpv24\n ),\n\n cte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_insee_appartenance_geo_qpv24\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_qpv24\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.940386Z", "completed_at": "2025-11-18T13:40:02.947998Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.948458Z", "completed_at": "2025-11-18T13:40:02.948465Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008914470672607422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_insee_arrondissement", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_insee_arrondissement\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_insee_arrondissement\n * Cible :          stg_insee_arrondisssement\n*/\n\n\n\n\n with\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_insee_arrondissement as \n (\n    select\n        [_meta_year]             as arrondissement_annee,\n        [CODGEO]                 as arrondissement_code,\n        [LIBGEO]                 as arrondissement_libelle,\n        [DEP]                    as departement_code,\n--      [CTCD],\n        [REG]                    as region_code,\n        [EPCI]                   as epci_code,\n        [EPT]                    as ept_code,\n        --[ARR]\n        --[CANOV],\n        --[ZE2020],\n        --[UU2020],\n        --[AAV2020],\n        --[BV2022],\n        [COM]                    as commune_code\n\n    from\n        \"wh_dp_bronze\".\"raw\".\"raw_insee_arrondissement\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_insee_arrondissement as \n (\n    select\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when arrondissement_annee is null \n          or arrondissement_annee in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(arrondissement_annee as integer) is not null \n        then cast(arrondissement_annee as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(arrondissement_annee as float) is not null \n        then cast(cast(arrondissement_annee as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as arrondissement_annee,\n        arrondissement_code,\n        arrondissement_libelle,\n        departement_code,\n        region_code,\n        epci_code,\n        ept_code,\n        commune_code\n\n    from  cte_rename_raw_insee_arrondissement\n ),\n \ncte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_insee_arrondissement\n)\n\n     \n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_insee_arrondissement\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.950638Z", "completed_at": "2025-11-18T13:40:02.960913Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.961472Z", "completed_at": "2025-11-18T13:40:02.961478Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011680364608764648, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_insee_commune_residence_principale_histo", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_insee_commune_residence_principale_histo\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_insee_commune_residence_principale_histo\n * Cible :          stg_insee_commune_residence_principale_histo\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_insee_commune_residence_principale_histo as \n (\n    select \n        [CODGEO]                 as commune_code,\n        [LIBGEO]                 as commune_libelle,\n        [AN]                     as commune_annee,\n        [P_LOG]                  as logements_prives_nombre\n      \n      from   \"wh_dp_bronze\".\"raw\".\"raw_insee_commune_residence_principale_histo\"\n ),\n\n\n-------------------------------------------------------------------\n--************* TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\n\ncte_finale as\n(\n    select \n        commune_code,\n        commune_libelle,\n        commune_annee,\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when logements_prives_nombre is null \n          or logements_prives_nombre in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(logements_prives_nombre as integer) is not null \n        then cast(logements_prives_nombre as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(logements_prives_nombre as float) is not null \n        then cast(cast(logements_prives_nombre as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n    as logements_prives_nombre,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n                               as _meta_loaded_at\n\n    from cte_rename_raw_insee_commune_residence_principale_histo\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_insee_commune_residence_principale_histo\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.963345Z", "completed_at": "2025-11-18T13:40:02.971814Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.972260Z", "completed_at": "2025-11-18T13:40:02.972266Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010027408599853516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_insee_epci", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_insee_epci\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_insee_epci\n * Cible :          stg_insee_epci \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_insee_epci as \n (\n    select \n        [_meta_year]                 as epci_annee,\n        [EPCI]                       as epci_code,\n        [LIBEPCI]                    as epci_libelle,\n        [NATURE_EPCI]                as epci_nature_code\n      \n    from   \"wh_dp_bronze\".\"raw\".\"raw_insee_epci\"\n ),\n\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\n\ncte_clean_and_type_raw_insee_epci as \n (\n    select\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when epci_annee is null \n          or epci_annee in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(epci_annee as integer) is not null \n        then cast(epci_annee as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(epci_annee as float) is not null \n        then cast(cast(epci_annee as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as epci_annee,\n        epci_code,\n        epci_libelle,\n        epci_nature_code\n      \n    from   cte_rename_raw_insee_epci\n ),\n\n cte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_insee_epci\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_insee_epci\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.974269Z", "completed_at": "2025-11-18T13:40:02.982767Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.983209Z", "completed_at": "2025-11-18T13:40:02.983220Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009964466094970703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_insee_lib_zone_supra_communale", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_insee_lib_zone_supra_communale\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_insee_lib_zone_supra_communale\n * Cible :          stg_insee_lib_zone_supra_communale \n */\n\n\n\n\n with\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_insee_lib_zone_supra_communale as \n (\n    select \n        [_meta_year]                as geographie_annee,\n        [CODGEO]                    as geographie_code,\n        [LIBGEO]                    as geographie_libelle,\n        [NIVGEO]                    as geographie_niveau\n     \n    from   \"wh_dp_bronze\".\"raw\".\"raw_insee_lib_zone_supra_communale\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_insee_lib_zone_supra_communale as\n(\n\n    select\n       \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when  geographie_annee is null \n          or  geographie_annee in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast( geographie_annee as integer) is not null \n        then cast( geographie_annee as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast( geographie_annee as float) is not null \n        then cast(cast( geographie_annee as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as  geographie_annee,\n       geographie_code,\n       geographie_libelle,\n       geographie_niveau\n\n    from\n        cte_rename_raw_insee_lib_zone_supra_communale\n),\n\n \ncte_finale as\n(\n    select \n        *\n     , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_insee_lib_zone_supra_communale\n)\n     \n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_insee_lib_zone_supra_communale\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.985009Z", "completed_at": "2025-11-18T13:40:02.995084Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:02.995610Z", "completed_at": "2025-11-18T13:40:02.995617Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011650562286376953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_insee_passage_commune", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_insee_passage_commune\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_insee_passage_commune\n * Cible :          stg_passage_commune_histo\n */\n\n\n\n\n with\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_insee_passage_commune as \n (\n    select \n        [_meta_year]                as passage_commune_annee,\n        [CODGEO_INI]                as commune_initiale_code,\n        [CODGEO]                    as commune_finale_code,   \n        [LIBGEO]                    as commune_finale_libelle\n \n    from   \"wh_dp_bronze\".\"raw\".\"raw_insee_passage_commune\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_insee_passage_commune as \n (\n    select\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when passage_commune_annee is null \n          or passage_commune_annee in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(passage_commune_annee as integer) is not null \n        then cast(passage_commune_annee as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(passage_commune_annee as float) is not null \n        then cast(cast(passage_commune_annee as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as passage_commune_annee,\n        commune_initiale_code,\n        commune_finale_code,\n        commune_finale_libelle\n\n    from  cte_rename_raw_insee_passage_commune\n ),\n \ncte_finale as\n(\n    select \n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_clean_and_type_raw_insee_passage_commune\n)\n\n     \n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_insee_passage_commune\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:02.997366Z", "completed_at": "2025-11-18T13:40:03.006407Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.006848Z", "completed_at": "2025-11-18T13:40:03.006854Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010263681411743164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_ministere_zone_123", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_ministere_zone_123\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_ministere_zone_123\n * Cible :          stg_ministere_zone_123\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_ministere_zone_123 as \n (\n    select \n        [CODGEO]                  as commune_code,\n        [ZONE]                    as zone_123_code\n      \n    from   \"wh_dp_bronze\".\"raw\".\"raw_ministere_zone_123\"\n ),\n\n\n-------------------------------------------------------------------\n--************* TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\n\ncte_finale as\n(\n    select \n        commune_code\n        , isnull(zone_123_code,'N/A')   as zone_123_code\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_rename_raw_ministere_zone_123\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_ministere_zone_123\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.008247Z", "completed_at": "2025-11-18T13:40:03.016117Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.016569Z", "completed_at": "2025-11-18T13:40:03.016576Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009387969970703125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_ministere_zone_abc", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_ministere_zone_abc\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_ministere_zone_abc\n * Cible :          stg_ministere_zone_abc\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_ministere_zone_abc as \n (\n    select \n        [CODGEO]                  as commune_code,\n        [ZONE]                    as zone_abc_code\n      \n    from   \"wh_dp_bronze\".\"raw\".\"raw_ministere_zone_abc\"\n ),\n\n\n-------------------------------------------------------------------\n--************* TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\n\ncte_finale as\n(\n    select \n        commune_code\n        , isnull(zone_abc_code,'N/A')   as zone_abc_code\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n\n    from cte_rename_raw_ministere_zone_abc\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_ministere_zone_abc\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.018973Z", "completed_at": "2025-11-18T13:40:03.032675Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.033172Z", "completed_at": "2025-11-18T13:40:03.033180Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.014863729476928711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.stg_sdes_rpls_logement", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table staging stg_sdes_rpls_logement\n *                  Renommage, nettoyage, typage\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          raw_sdes_rpls_logement\n * Cible :          stg_sdes_rpls_logement \n */\n\n\n\n\n with\n\n-------------------------------------------------------------------\n--******************* RENOMMAGE DES COLONNES **********************\n-------------------------------------------------------------------\n cte_rename_raw_sdes_rpls_logement as \n (\n    select \n        [_meta_year]                as logement_rpls_millesime,\n        [IDENT_REP]                 as logement_rpls_id,\n        [IDENT_INT]                 as logement_bailleur_systeme_id,\n        [IDENT_ORG]                 as organisme_id,\n        [DROIT]                     as immobilier_droit_code,\n        [DEPCOM]                    as commune_code,\n        [CODEPOSTAL]                as adresse_postale_code,\n        [LIBCOM]                    as commune_libelle,\n        [NUMVOIE]                   as adresse_voie_num,\n        [INDREP]                    as adresse_voie_indice_repetition_libelle,\n        [TYPVOIE]                   as adresse_voie_type_libelle,\n        [NOMVOIE]                   as adresse_voie_libelle,\n        [NUMAPPT]                   as adresse_appartement_num,\n        [NUMBOITE]                  as adresse_boite_num ,\n        [ESC]                       as adresse_escalier_num,\n        [COULOIR]                   as adresse_couloir_libelle,\n        [ETAGE]                     as adresse_etage_num ,\n        [COMPLIDENT]                as adresse_logement_complement_libelle,\n        [ENTREE]                    as adresse_entree_num,\n        [BAT]                       as adresse_batiment_num,\n        [IMMEU]                     as adresse_immeuble_num,\n        [COMPLGEO]                  as adresse_batiment_complement_libelle,\n        [LIEUDIT]                   as adresse_lieu_dit_libelle,\n        [QPV]                       as qpv_flag ,\n        [TYPECONST]                 as construction_type_code,\n        [NBPIECE]                   as piece_nombre_code,\n        [SURFHAB]                   as surface_habitable_m2,\n        [CONSTRUCT]                 as construction_achevement_annee,\n        [LOCAT]                     as mise_en_location_premiere_annee,\n        [PATRIMOINE]                as patrimoine_entree_annee,\n        [ORIGINE]                   as patrimoine_origine_code,\n        [RSEXPRO]                   as proprietaire_precedent_raison_sociale_libelle,\n        [SIRETEXPRO]                as proprietaire_precedent_siret_num,\n        [FINAN]                     as financement_initial_code,\n        [FINANAUTRE]                as financement_autre_libelle,\n        [CONV]                      as convention_flag,\n        [NUMCONV]                   as convention_num,\n        [DATCONV]                   as convention_date,\n        [SORTIEPATRIM]              as patrimoine_sortie_code,\n        [OLDLOGT]                   as logement_old_code,\n        [NEWLOGT]                   as logement_new_code,\n        [MODE]                      as occupation_mode_code,\n        [BAIL]                      as bail_effet_mois,\n        [MODESURF]                  as surface_mode_code,\n        [SURFMODE]                  as surface_mode_m2,\n        [LOYERPRINC]                as loyer_principal_mensuel_montant,\n        [LOYERACC]                  as loyer_accessoire_mensuel_montant,\n        [CONTRIB]                   as contribution_montant,\n        -- a changer\n        [CUS]                       as financement_cus_code,\n\n        [DPEDATE]                   as dpe_mois,\n        [DPEENERGIE]                as dpe_energie_code,\n        [DPESERRE]                  as dpe_ges_code,\n        [SRU_EXPIR]                 as sru_expiration_annee,\n        [SRU_ALINEA]                as sru_alinea_code,\n        [IDENTGES]                  as organisme_gestionnaire_id,\n        [CODSEGPATRIM]              as patrimoine_segment_code,\n        [LIBSEGPATRIM]              as patrimoine_segment_libelle,\n        [LOYERMAXAPL]               as loyer_maximal_apl_mensuel_montant,\n        [LOYERMAXCUS]               as loyer_maximal_cus_mensuel_montant,\n        [QUALACQ]                   as vente_type_code,\n        [MISCOMMERCIAL]             as mise_en_commercialisation_code,\n        [PRIXVENTE]                 as vente_prix_montant,\n        [PRODFIN]                   as produit_financier_net_montant,\n        [REMLOCDATE]                as remise_en_location_mois,\n        [CONTRESLOG]                as reservation_contingent_code,\n        [PMR]                       as pmr_code,\n        [DATMISEVENTE]              as vente_autorisation_mois,\n        [DATVEFFECT]                as vente_effective_mois,\n        [DATE_DEP_DERLOCAT]         as locataire_dernier_depart_date,\n        [DPE_CONSO_ENER]            as dpe_energie_consommation_valeur,\n        [DPE_CONSO_GES]             as dpe_ges_consommation_valeur,\n        [DPE_NUM_REF]               as dpe_reference_num,\n        [IDENT_FISCAL]              as logement_fiscal_id,\n        [CAT_ORG]                   as organisme_categorie_code,\n        [RS]                        as organisme_raison_sociale_libelle,\n        [SIRET]                     as organisme_siret_code,\n        [DEP]                       as departement_code,\n        [LIBDEP]                    as departement_libelle,\n        [REG]                       as region_code,\n        [LIBREG]                    as region_libelle ,\n        [EPCI]                      as epci_code ,\n        [LIBEPCI]                   as epci_libelle,\n        [DEPARTEMENTS_DE_L_EPCI]    as departements_epci_list,\n        [REGIONS_DE_L_EPCI]         as regions_epci_list,\n        --[ARN],\n        [finan_cus]                 as var_financement_groupe_libelle,\n        [mes_sanscumul]             as var_mise_en_service_flag,\n        [loymoy]                    as var_loyer_moyen_mensuel_m2_montant,\n        [age]                       as var_logement_anciennete_en_annee,\n        [deconv]                    as var_deconventionnement_flag,\n        [duree_vacance]             as var_duree_vacance_mois,\n        [ANNEE_REMLOC]              as var_remise_en_location_annee,\n        [MOIS_REMLOC]               as var_remise_en_location_mois,\n        [MOIS_BAIL]                 as var_bail_effet_mois,\n        [ANNEE_BAIL]                as var_bail_effet_annee,\n        [BAIL_DATE]                 as var_bail_effet_date ,\n        [REMLOCDATE_DATE]           as var_remise_en_location_date\n      \n \n    from   \"wh_dp_bronze\".\"raw\".\"raw_sdes_rpls_logement\"\n ),\n\n-------------------------------------------------------------------\n--************* NETTOYAGE ET TYPAGE DES COLONNES ******************\n-------------------------------------------------------------------\ncte_clean_and_type_raw_sdes_rpls_logement as\n(\n\n    select\n \n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when logement_rpls_millesime is null \n          or logement_rpls_millesime in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(logement_rpls_millesime as integer) is not null \n        then cast(logement_rpls_millesime as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(logement_rpls_millesime as float) is not null \n        then cast(cast(logement_rpls_millesime as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n            as logement_rpls_millesime,\n        \n    case\n        when logement_rpls_millesime is null or trim(logement_rpls_millesime) = '' then CAST(NULL AS DATE)\n        when upper(trim(logement_rpls_millesime)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(logement_rpls_millesime)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(logement_rpls_millesime + '-01-01' AS DATE)\n        \n    end\n        as logement_rpls_millesime_date,\n        logement_rpls_id,\n        logement_bailleur_systeme_id,\n        organisme_id,\n        \n    case \n        when immobilier_droit_code in ('NA', '0','NC','Z') or immobilier_droit_code is null \n            then 'N/A'\n        else immobilier_droit_code\n    end\n          as immobilier_droit_code,\n        commune_code,\n        adresse_postale_code,\n        commune_libelle,\n        adresse_voie_num,\n        adresse_voie_indice_repetition_libelle,\n        adresse_voie_type_libelle,\n        adresse_voie_libelle,\n        adresse_appartement_num,\n        adresse_boite_num,\n        adresse_escalier_num,\n        adresse_couloir_libelle,\n        adresse_etage_num,\n        adresse_logement_complement_libelle,\n        adresse_entree_num,\n        adresse_batiment_num,\n        adresse_immeuble_num,\n        adresse_batiment_complement_libelle,\n        adresse_lieu_dit_libelle,\n        \n  \n  case\n    when trim(qpv_flag) = '1' then cast(1 as bit)\n    else cast(0 as bit)\n  end\n as qpv_flag,\n        \n    case \n        when construction_type_code in ('NA', '0','NC','Z') or construction_type_code is null \n            then 'N/A'\n        else construction_type_code\n    end\n                 as construction_type_code,\n        piece_nombre_code,\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when surface_habitable_m2 is null \n          or surface_habitable_m2 in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(surface_habitable_m2 as integer) is not null \n        then cast(surface_habitable_m2 as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(surface_habitable_m2 as float) is not null \n        then cast(cast(surface_habitable_m2 as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n                   as surface_habitable_m2,\n        \n    case\n        when construction_achevement_annee is null or trim(construction_achevement_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(construction_achevement_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(construction_achevement_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(construction_achevement_annee + '-01-01' AS DATE)\n        \n    end\n     as construction_achevement_annee,\n        \n    case\n        when mise_en_location_premiere_annee is null or trim(mise_en_location_premiere_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(mise_en_location_premiere_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(mise_en_location_premiere_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(mise_en_location_premiere_annee + '-01-01' AS DATE)\n        \n    end\n   as mise_en_location_premiere_annee,\n        \n    case\n        when patrimoine_entree_annee is null or trim(patrimoine_entree_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(patrimoine_entree_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(patrimoine_entree_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(patrimoine_entree_annee + '-01-01' AS DATE)\n        \n    end\n           as patrimoine_entree_annee,\n        patrimoine_origine_code,\n        proprietaire_precedent_raison_sociale_libelle,\n        proprietaire_precedent_siret_num,\n        financement_initial_code,\n        financement_autre_libelle,\n        case when  region_code in ('01', '02', '03', '04', '06') then cast (0 as bit) else  \n  \n  case\n    when trim(convention_flag) = '1' then cast(1 as bit)\n    else cast(0 as bit)\n  end\n end as convention_flag,\n        case when  region_code in ('01', '02', '03', '04', '06') then 'N/A' end as convention_num,\n        case when  region_code in ('01', '02', '03', '04', '06')  then null else \n    case\n        when convention_date is null or trim(convention_date) = '' then CAST(NULL AS DATE)\n        when upper(trim(convention_date)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(convention_date)) != 10 then CAST(NULL AS DATE)\n            else TRY_CAST(REPLACE(convention_date, '/', '-') AS DATE)\n\n        \n    end\n end as convention_date,\n        \n    case \n        when patrimoine_sortie_code in ('NA', '0','NC','Z') or patrimoine_sortie_code is null \n            then 'N/A'\n        else patrimoine_sortie_code\n    end\n as patrimoine_sortie_code,\n        logement_old_code,\n        logement_new_code,\n        \n    case \n        when occupation_mode_code in ('NA', '0','NC','Z') or occupation_mode_code is null \n            then 'N/A'\n        else occupation_mode_code\n    end\n as occupation_mode_code,\n        \n    case\n        when bail_effet_mois is null or trim(bail_effet_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(bail_effet_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(bail_effet_mois)) != 7 then CAST(NULL AS DATE)\n            else TRY_CAST('01-' + REPLACE(bail_effet_mois, '/', '-') AS DATE)\n\n        \n    end\n as bail_effet_mois,\n        \n    case \n        when surface_mode_code in ('NA', '0','NC','Z') or surface_mode_code is null \n            then 'N/A'\n        else surface_mode_code\n    end\n as surface_mode_code,\n        surface_mode_m2,\n        \n  \n  case\n    when try_cast(trim(replace(loyer_principal_mensuel_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(loyer_principal_mensuel_montant, ',', '.')) as float)\n    else null\n  end\n as loyer_principal_mensuel_montant,\n        \n  \n  case\n    when try_cast(trim(replace(loyer_accessoire_mensuel_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(loyer_accessoire_mensuel_montant, ',', '.')) as float)\n    else null\n  end\n as loyer_accessoire_mensuel_montant,\n        \n  \n  case\n    when try_cast(trim(replace(contribution_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(contribution_montant, ',', '.')) as float)\n    else null\n  end\n as contribution_montant,\n        financement_cus_code,\n        \n    case\n        when dpe_mois is null or trim(dpe_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(dpe_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(dpe_mois)) != 7 then CAST(NULL AS DATE)\n            else TRY_CAST('01-' + REPLACE(dpe_mois, '/', '-') AS DATE)\n\n        \n    end\n  as dpe_mois,\n        \n    case \n        when dpe_energie_code in ('NA', '0','NC','Z') or dpe_energie_code is null \n            then 'N/A'\n        else dpe_energie_code\n    end\n as dpe_energie_code,\n        \n    case \n        when dpe_ges_code in ('NA', '0','NC','Z') or dpe_ges_code is null \n            then 'N/A'\n        else dpe_ges_code\n    end\n as dpe_ges_code,\n        case when  region_code in ('01', '02', '03', '04', '06')  then null else \n    case\n        when sru_expiration_annee is null or trim(sru_expiration_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(sru_expiration_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(sru_expiration_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(sru_expiration_annee + '-01-01' AS DATE)\n        \n    end\n end as sru_expiration_annee,\n        sru_alinea_code,\n        organisme_gestionnaire_id,\n        patrimoine_segment_code,\n        patrimoine_segment_libelle,\n        \n  \n  case\n    when try_cast(trim(replace(loyer_maximal_apl_mensuel_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(loyer_maximal_apl_mensuel_montant, ',', '.')) as float)\n    else null\n  end\n as loyer_maximal_apl_mensuel_montant,\n        \n  \n  case\n    when try_cast(trim(replace(loyer_maximal_cus_mensuel_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(loyer_maximal_cus_mensuel_montant, ',', '.')) as float)\n    else null\n  end\n as loyer_maximal_cus_mensuel_montant,\n        \n    case \n        when vente_type_code in ('NA', '0','NC','Z') or vente_type_code is null \n            then 'N/A'\n        else vente_type_code\n    end\n as vente_type_code,\n        mise_en_commercialisation_code,\n        \n  \n  case\n    when try_cast(trim(replace(vente_prix_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(vente_prix_montant, ',', '.')) as float)\n    else null\n  end\n as vente_prix_montant,\n        \n  \n  case\n    when try_cast(trim(replace(produit_financier_net_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(produit_financier_net_montant, ',', '.')) as float)\n    else null\n  end\n as produit_financier_net_montant,\n        \n    case\n        when remise_en_location_mois is null or trim(remise_en_location_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(remise_en_location_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(remise_en_location_mois)) != 7 then CAST(NULL AS DATE)\n            else TRY_CAST('01-' + REPLACE(remise_en_location_mois, '/', '-') AS DATE)\n\n        \n    end\n as remise_en_location_mois,\n        reservation_contingent_code,\n        \n    case \n        when pmr_code in ('NA', '0','NC','Z') or pmr_code is null \n            then 'N/A'\n        else pmr_code\n    end\n as pmr_code,\n        \n    case\n        when vente_autorisation_mois is null or trim(vente_autorisation_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(vente_autorisation_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(vente_autorisation_mois)) != 7 then CAST(NULL AS DATE)\n            else TRY_CAST('01-' + REPLACE(vente_autorisation_mois, '/', '-') AS DATE)\n\n        \n    end\n as vente_autorisation_mois,\n        \n    case\n        when vente_effective_mois is null or trim(vente_effective_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(vente_effective_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(vente_effective_mois)) != 7 then CAST(NULL AS DATE)\n            else TRY_CAST('01-' + REPLACE(vente_effective_mois, '/', '-') AS DATE)\n\n        \n    end\n as vente_effective_mois,\n        \n    case\n        when locataire_dernier_depart_date is null or trim(locataire_dernier_depart_date) = '' then CAST(NULL AS DATE)\n        when upper(trim(locataire_dernier_depart_date)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(locataire_dernier_depart_date)) != 10 then CAST(NULL AS DATE)\n            else TRY_CAST(REPLACE(locataire_dernier_depart_date, '/', '-') AS DATE)\n\n        \n    end\n as locataire_dernier_depart_date,\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when dpe_energie_consommation_valeur is null \n          or dpe_energie_consommation_valeur in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(dpe_energie_consommation_valeur as integer) is not null \n        then cast(dpe_energie_consommation_valeur as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(dpe_energie_consommation_valeur as float) is not null \n        then cast(cast(dpe_energie_consommation_valeur as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as dpe_energie_consommation_valeur,\n        \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when dpe_ges_consommation_valeur is null \n          or dpe_ges_consommation_valeur in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(dpe_ges_consommation_valeur as integer) is not null \n        then cast(dpe_ges_consommation_valeur as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(dpe_ges_consommation_valeur as float) is not null \n        then cast(cast(dpe_ges_consommation_valeur as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n as dpe_ges_consommation_valeur,\n        dpe_reference_num,\n        logement_fiscal_id,\n        organisme_categorie_code,\n        organisme_raison_sociale_libelle,\n        RIGHT('00000000000000' + organisme_siret_code, 14) as organisme_siret_code,\n        departement_code,\n        departement_libelle,\n        region_code,\n        region_libelle,\n        epci_code,\n        epci_libelle,\n        departements_epci_list,\n        regions_epci_list,\n        var_financement_groupe_libelle,\n        var_mise_en_service_flag,\n        \n  \n  case\n    when try_cast(trim(replace(var_loyer_moyen_mensuel_m2_montant, ',', '.')) as float) is not null\n      then cast(trim(replace(var_loyer_moyen_mensuel_m2_montant, ',', '.')) as float)\n    else null\n  end\n as var_loyer_moyen_mensuel_m2_montant,\n        var_logement_anciennete_en_annee,\n        var_deconventionnement_flag,\n        \n    case\n        when var_duree_vacance_mois is null or trim(var_duree_vacance_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_duree_vacance_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_duree_vacance_mois)) != 10 then CAST(NULL AS DATE)\n            else TRY_CAST(REPLACE(var_duree_vacance_mois, '/', '-') AS DATE)\n\n        \n    end\n  as var_duree_vacance_mois,\n        \n    case\n        when var_remise_en_location_annee is null or trim(var_remise_en_location_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_remise_en_location_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_remise_en_location_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(var_remise_en_location_annee + '-01-01' AS DATE)\n        \n    end\n  as var_remise_en_location_annee,\n        \n    case\n        when var_remise_en_location_mois is null or trim(var_remise_en_location_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_remise_en_location_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_remise_en_location_mois)) != 10 then CAST(NULL AS DATE)\n            else TRY_CAST(REPLACE(var_remise_en_location_mois, '/', '-') AS DATE)\n\n        \n    end\n as var_remise_en_location_mois,\n        \n    case\n        when var_bail_effet_mois is null or trim(var_bail_effet_mois) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_bail_effet_mois)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_bail_effet_mois)) != 10 then CAST(NULL AS DATE)\n            else TRY_CAST(REPLACE(var_bail_effet_mois, '/', '-') AS DATE)\n\n        \n    end\n as var_bail_effet_mois,\n        \n    case\n        when var_bail_effet_annee is null or trim(var_bail_effet_annee) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_bail_effet_annee)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_bail_effet_annee)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(var_bail_effet_annee + '-01-01' AS DATE)\n        \n    end\n as var_bail_effet_annee,\n        \n    case\n        when var_bail_effet_date is null or trim(var_bail_effet_date) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_bail_effet_date)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_bail_effet_date)) != 10 then CAST(NULL AS DATE)\n            else TRY_CAST(REPLACE(var_bail_effet_date, '/', '-') AS DATE)\n\n        \n    end\n as var_bail_effet_date,\n        \n    case\n        when var_remise_en_location_date is null or trim(var_remise_en_location_date) = '' then CAST(NULL AS DATE)\n        when upper(trim(var_remise_en_location_date)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(var_remise_en_location_date)) != 10 then CAST(NULL AS DATE)\n            else TRY_CAST(REPLACE(var_remise_en_location_date, '/', '-') AS DATE)\n\n        \n    end\n as var_remise_en_location_date\n\n    from\n        cte_rename_raw_sdes_rpls_logement\n),\n\n \ncte_finale as\n(\n    select \n        *\n        , cast(current_timestamp as datetime2(3)) as _meta_loaded_at\n\n    from cte_clean_and_type_raw_sdes_rpls_logement\n)\n     \n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"stg\".\"stg_sdes_rpls_logement\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.034495Z", "completed_at": "2025-11-18T13:40:03.044893Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.045362Z", "completed_at": "2025-11-18T13:40:03.045368Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011464357376098633, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.test", "compiled": true, "compiled_code": "select\n    _meta_year,\n    DATE_DEP_DERLOCAT,\n    \n    case\n        when DATE_DEP_DERLOCAT is null or trim(DATE_DEP_DERLOCAT) = '' then CAST(NULL AS DATE)\n        when upper(trim(DATE_DEP_DERLOCAT)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(DATE_DEP_DERLOCAT)) != 10 then CAST(NULL AS DATE)\n            else TRY_CAST(REPLACE(DATE_DEP_DERLOCAT, '/', '-') AS DATE)\n\n        \n    end\n as date_naissance_clean,\n    REMLOCDATE,\n    \n    case\n        when REMLOCDATE is null or trim(REMLOCDATE) = '' then CAST(NULL AS DATE)\n        when upper(trim(REMLOCDATE)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(REMLOCDATE)) != 7 then CAST(NULL AS DATE)\n            else TRY_CAST('01-' + REPLACE(REMLOCDATE, '/', '-') AS DATE)\n\n        \n    end\n as mois_reference_clean,\n    CONSTRUCT,\n    \n    case\n        when CONSTRUCT is null or trim(CONSTRUCT) = '' then CAST(NULL AS DATE)\n        when upper(trim(CONSTRUCT)) in ('NA', 'NA/NA') then CAST(NULL AS DATE)\n\n        \n            when len(trim(CONSTRUCT)) != 4 then CAST(NULL AS DATE)\n            else TRY_CAST(CONSTRUCT + '-01-01' AS DATE)\n        \n    end\n as annee_reference_clean,\n    DPEENERGIE,\n    \n    case \n        when DPEENERGIE in ('NA', '0','NC','Z') or DPEENERGIE is null \n            then 'N/A'\n        else DPEENERGIE\n    end\n as dpe_energie_clean,\n    PMR,\n    \n    case \n        when PMR in ('NA', '0','NC','Z') or PMR is null \n            then 'N/A'\n        else PMR\n    end\n  as pmr_clean,\n    MODESURF,\n    \n    case \n        when MODESURF in ('NA', '0','NC','Z') or MODESURF is null \n            then 'N/A'\n        else MODESURF\n    end\n as mode_surf_clean,\n    LOYERPRINC,\n    \n  \n  case\n    when try_cast(trim(replace(LOYERPRINC, ',', '.')) as float) is not null\n      then cast(trim(replace(LOYERPRINC, ',', '.')) as float)\n    else null\n  end\n  as loyer_princ_type,\n    REG,\n     case when  REG in ('01', '02', '03', '04', '06') then 'outre-mer' end as reg_clean,\n    SURFMODE,\n     \n    case\n        -- Valeurs nulles ou codes \u00e0 ignorer\n        when SURFMODE is null \n          or SURFMODE in ('999', 'NA') \n        then CAST(NULL AS INTEGER)\n\n        -- Cas o\u00f9 la valeur peut \u00eatre cast\u00e9e directement en entier\n        when try_cast(SURFMODE as integer) is not null \n        then cast(SURFMODE as integer)\n\n        -- Cas o\u00f9 la valeur est au format scientifique (ex: '1.1144e+006')\n        when try_cast(SURFMODE as float) is not null \n        then cast(cast(SURFMODE as float) as integer)\n\n        -- Sinon, valeur par d\u00e9faut\n        else CAST(NULL AS INTEGER)\n    end\n  as surface_mode_m2_type,\n     CONV,\n     \n  \n  case\n    when trim(CONV) = '1' then cast(1 as bit)\n    else cast(0 as bit)\n  end\n  as convention_flag,\n    SIRET,\n    RIGHT('00000000000000' + SIRET, 14) as organisme_siret_code,\n    \n    case\n        when year(_meta_year) = (\n            select max(year(_meta_year))\n            from \"wh_dp_bronze\".\"raw\".\"raw_sdes_rpls_logement\"\n        ) then 1\n        else 0\n    end\n as is_last_year\n    \n\nfrom \"wh_dp_bronze\".\"raw\".\"raw_sdes_rpls_logement\"", "relation_name": "\"wh_dp_bronze\".\"test\".\"test\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.047268Z", "completed_at": "2025-11-18T13:40:03.048222Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.048500Z", "completed_at": "2025-11-18T13:40:03.048504Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002160787582397461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_dataplatform.map_departement_region", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.050482Z", "completed_at": "2025-11-18T13:40:03.051281Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.051533Z", "completed_at": "2025-11-18T13:40:03.051537Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002207040786743164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_dataplatform.map_epci_nature_code", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.053377Z", "completed_at": "2025-11-18T13:40:03.055996Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.056294Z", "completed_at": "2025-11-18T13:40:03.056298Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0039806365966796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_dataplatform.map_financement_groupe", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.057433Z", "completed_at": "2025-11-18T13:40:03.058153Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.058391Z", "completed_at": "2025-11-18T13:40:03.058395Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.001482248306274414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_dataplatform.map_patrimoine_sortie", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.060187Z", "completed_at": "2025-11-18T13:40:03.061445Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.061719Z", "completed_at": "2025-11-18T13:40:03.061723Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002569913864135742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_dataplatform.map_pmr_code", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.062856Z", "completed_at": "2025-11-18T13:40:03.063852Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.064099Z", "completed_at": "2025-11-18T13:40:03.064103Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0017895698547363281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_dataplatform.ref_dataplatform", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.065594Z", "completed_at": "2025-11-18T13:40:03.074998Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.075476Z", "completed_at": "2025-11-18T13:40:03.075482Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010709762573242188, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.calendrier", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table cale drier\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_calendrier\n * Cible :          calendrier\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_calendrier as\n(\n    select\n        date_iso,\n        date_fr_char,\n        date_annee_int,\n        date_annee_char,\n        date_mois_int,\n        date_mois_char,\n        date_jour_int,\n        date_jour_char\n\n    from \"wh_dp_silver\".\"int\".\"int_calendrier\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    \n    from cte_int_calendrier\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"calendrier\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.076849Z", "completed_at": "2025-11-18T13:40:03.087051Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.087489Z", "completed_at": "2025-11-18T13:40:03.087499Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011271238327026367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_organisme", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_organisme\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          stg_crm_entreprise\n * Cible :          int_organisme\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_entreprise as \n(\n    select \n        organisme_raison_sociale_libelle,\n        organisme_statut_code,\n        organisme_type_code,\n        organisme_siren_code,\n        organisme_sous_famille_code,\n        organisme_code_union,\n        organisme_id_code\n        \n    from \n        \"wh_dp_silver\".\"stg\".\"stg_crm_entreprise\"\n),\n/*\ncte_stg_reference as\n(\n\n),\n\ncte_stg_orfi_group as \n(\n\n)\n*/\n\n \n-------------------------------------------------------------------\n--************************** FILTRAGE ****************************\n-------------------------------------------------------------------\n-- on souhaite recueperer que les organismes actifs\ncte_filter_stg_entreprise as \n(\n    select \n        *\n        \n    from \n        cte_stg_entreprise\n\n    where organisme_statut_code = 'ACT'\n),\n\n-------------------------------------------------------------------\n--************* JOINTURE ET COLONNES CALCULEES ********************\n-------------------------------------------------------------------\ncte_calc_stg_entreprise  as \n (\n    select\n        organisme_raison_sociale_libelle,\n        organisme_statut_code,\n        organisme_type_code,\n        organisme_siren_code,\n        organisme_sous_famille_code,\n        organisme_code_union,\n        organisme_id_code\n    \n    from cte_filter_stg_entreprise\n    --left join cte_stg_reference on ....\n    --left join cte_stg_orfi_group on ....\n ),\n\n\n-------------------------------------------------------------------\n--********************** CLES TECHNIQUES *************************\n-------------------------------------------------------------------\ncte_hk_calc_stg_entreprise as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_id_code as varchar(max))\n    \n)  \n \n           as organisme_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_statut_code as varchar(max))\n    \n)  \n \n       as organisme_statut_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_type_code as varchar(max))\n    \n)  \n \n         as organisme_type_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_sous_famille_code as varchar(max))\n    \n)  \n \n  as organisme_sous_famille_hk\n         \n    from \n        cte_calc_stg_entreprise\n),\n \n-------------------------------------------------------------------\n--********************** ETAPE FINALE *************************\n-------------------------------------------------------------------\n \n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_stg_entreprise\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_organisme\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.089388Z", "completed_at": "2025-11-18T13:40:03.097657Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.098251Z", "completed_at": "2025-11-18T13:40:03.098258Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0099029541015625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_qpv", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_qpv\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Full refresh / overwrite\n * Sources:         stg_insee_appartenance_geo_qpv24 \n * Cible :          int_qpv\n *  \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_appartenance_geo_qpv24 as\n(\n    select\n        qpv_commune_annee    as qpv_annee     \n        , qpv_code           \n        , qpv_libelle       \n\n    from\n        \"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_qpv24\"\n\n),\n\n\n-- Ajout des colonnes calcul\u00e9es\n cte_calc_stg_insee_appartenance_geo_qpv24 as \n (\n    select\n        qpv_annee                          \n        , qpv_code                           \n        , qpv_libelle                       \n        , \n    case\n        when t1.qpv_annee = (\n            select max(t2.qpv_annee)\n            from cte_stg_insee_appartenance_geo_qpv24 t2\n            where t2.qpv_code = t1.qpv_code\n        ) then 1\n        else 0\n    end\n as qpv_annee_last_flag\n\n    from\n        cte_stg_insee_appartenance_geo_qpv24 t1\n    \n     \n ),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_stg_insee_appartenance_geo_qpv24 as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', qpv_annee, qpv_code) \n    \n)  \n \n as qpv_hk\n        , \n    \n        concat_ws('||', qpv_annee, qpv_code) \n    \n as qpv_bk\n        \n    from \n        cte_calc_stg_insee_appartenance_geo_qpv24\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_stg_insee_appartenance_geo_qpv24\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_qpv\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.099795Z", "completed_at": "2025-11-18T13:40:03.107984Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.108450Z", "completed_at": "2025-11-18T13:40:03.108457Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009371280670166016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_qpv_commune", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_qpv_commune\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Full refresh / overwrite\n * Source:          stg_insee_appartenance_geo_qpv24 \n * Cible :          int_qpv_commune \n * La table en source contient une liste de commune li\u00e9e \u00e0 un QPV. Dans ce traitement, la liste est d\u00e9coup\u00e9e\n * pour obtenir une ligne par couple qpv / commune\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_appartenance_geo_qpv24 as \n(\n    select \n        qpv_commune_annee,\n        qpv_code ,\n        qpv_libelle ,       \n        commune_code_liste \n        \n    from \n        \"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_qpv24\"\n),\n\n--On calcule le nombre de communes par qpv, sachant qu'un code commune est sur 5 caract\u00e8res\ncte_nb_communes_par_qpv  as\n(\n select\n        qpv_commune_annee,\n        qpv_code,\n        qpv_libelle,\n        commune_code_liste,\n        len(commune_code_liste) / 5 as nb_communes\n    from cte_stg_insee_appartenance_geo_qpv24\n)\n,\n\n-- Table de nombres de 1 \u00e0 15 : 10 \u00e9tant le max de communes recens\u00e9s pour un QPV (on prend de la marge)\ncte_numbers as (\n    select row_number() over (order by (select null)) as idx\n    from openjson(replicate('{\"x\":0},', 15) + '{\"x\":0}')\n),\n\n-- D\u00e9coupage des codes communes\ncte_split_stg_insee_appartenance_geo_qpv24 as (\n    select\n        b.qpv_commune_annee,\n        b.qpv_code,\n        b.qpv_libelle,\n        substring(b.commune_code_liste, ((n.idx - 1) * 5) + 1, 5) as commune_code\n    from cte_nb_communes_par_qpv b\n    join cte_numbers n\n        on n.idx <= b.nb_communes\n),\n\n-- Ajout des colonnes calcul\u00e9es\ncte_calc_stg_insee_appartenance_geo_qpv24  as \n (\n    select\n        qpv_commune_annee,\n        qpv_code,\n        qpv_libelle,\n        commune_code,\n        \n    case\n        when t1.qpv_commune_annee = (\n            select max(t2.qpv_commune_annee)\n            from cte_split_stg_insee_appartenance_geo_qpv24 t2\n            where t2.qpv_code = t1.qpv_code\n        ) then 1\n        else 0\n    end\n as qpv_commune_annee_last_flag\n\n    from \n        cte_split_stg_insee_appartenance_geo_qpv24 t1\n    \n ),\n\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_stg_insee_appartenance_geo_qpv24 as\n(\n    select \n        *\n        , \n    \n        concat_ws('||', qpv_commune_annee, qpv_code, commune_code) \n    \n as qpv_commune_bk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', qpv_commune_annee, qpv_code, commune_code) \n    \n)  \n \n as qpv_commune_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', qpv_commune_annee, qpv_code) \n    \n)  \n \n as qpv_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', qpv_commune_annee, commune_code) \n    \n)  \n \n as commune_hk\n    from \n        cte_calc_stg_insee_appartenance_geo_qpv24\n),\n \n-- Ajout des m\u00e9tadonn\u00e9es\n \n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_stg_insee_appartenance_geo_qpv24\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_qpv_commune\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.110379Z", "completed_at": "2025-11-18T13:40:03.117482Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.117961Z", "completed_at": "2025-11-18T13:40:03.117967Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008696556091308594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.unit_test", "compiled": true, "compiled_code": "\n\n-- Table source\nwith base as (\n    select\n        qpv_annee,\n        qpv_code,\n        qpv_libelle,\n        commune_code_liste,\n        len(commune_code_liste) / 5 as nb_communes\n    from \"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_qpv24\"\n),\n\n-- Table de nombres de 1 \u00e0 15\n\nnumbers as (\n    select row_number() over (order by (select null)) as idx\n    from openjson(replicate('{\"x\":0},', 15) + '{\"x\":0}')\n),\n\n\n-- D\u00e9coupage des codes communes\nexploded as (\n    select\n        b.qpv_annee,\n        b.qpv_code,\n        b.qpv_libelle,\n        substring(b.commune_code_liste, ((n.idx - 1) * 5) + 1, 5) as commune_code\n    from base b\n    join numbers n\n        on n.idx <= b.nb_communes\n)\n\n-- R\u00e9sultat final filtr\u00e9\nselect *\nfrom exploded", "relation_name": "\"wh_dp_bronze\".\"test\".\"unit_test\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.119348Z", "completed_at": "2025-11-18T13:40:03.128040Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.128503Z", "completed_at": "2025-11-18T13:40:03.128510Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009807109832763672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_arrondissement", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_arrondissement\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Sources:         stg_insee_arrondissement\n * Cible :          int_arrondissement \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_arrondissement as \n(\n    select\n         arrondissement_annee,\n         arrondissement_code,\n         arrondissement_libelle,\n         commune_code\n\n    from \n         \"wh_dp_silver\".\"stg\".\"stg_insee_arrondissement\"\n),\n\n-- Ajout des colonnes calcul\u00e9es\n cte_calc_stg_insee_arrondissement as \n (\n    select\n        *\n        , \n    case\n        when t1.arrondissement_annee = (\n            select max(t2.arrondissement_annee)\n            from cte_stg_insee_arrondissement t2\n            where t2.arrondissement_code = t1.arrondissement_code\n        ) then 1\n        else 0\n    end\n as arrondissement_annee_last_flag\n\n    from\n        cte_stg_insee_arrondissement t1   \n ),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_insee_arrondissement as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', arrondissement_annee, arrondissement_code) \n    \n)  \n \n   as arrondissement_hk\n        , \n    \n        concat_ws('||', arrondissement_annee, arrondissement_code) \n    \n   as arrondissement_bk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', arrondissement_annee, commune_code) \n    \n)  \n \n   as commune_hk\n\n    from \n        cte_calc_stg_insee_arrondissement\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_insee_arrondissement\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_arrondissement\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.129973Z", "completed_at": "2025-11-18T13:40:03.138851Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.139326Z", "completed_at": "2025-11-18T13:40:03.139332Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010060310363769531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_commune_residence_principale_histo", "compiled": true, "compiled_code": "-- -----------------------------------------------------------------------------\n-- Description :\n--   Ce mod\u00e8le alimente la table intermediate `int_commune_residence_principale_histo`.\n--   Il a pour r\u00f4le de compl\u00e9ter l\u2019historique des communes en g\u00e9n\u00e9rant les ann\u00e9es\n--   manquantes et en propageant la derni\u00e8re valeur connue.\n--\n-- Fr\u00e9quence :\n--   Annuel\n--\n-- Mode :\n--   Insert / Update\n--\n-- Source :\n--   `stg_insee_commune_residence_principale_histo`\n--\n-- Cible :\n--   `int_commune_residence_principale_histo`\n--\n-- D\u00e9tails :\n--   - Nous recevons chaque ann\u00e9e un seul fichier contenant l\u2019historique complet.\n--   - Le fichier est conserv\u00e9 dans le Lakehouse avec son ann\u00e9e de r\u00e9cup\u00e9ration\n--     ajout\u00e9e \u00e0 la fin du nom du fichier.\n--   - La table `raw_insee_commune_residence_principale_histo` ne contient que\n--     la derni\u00e8re version disponible.\n--   - Le pr\u00e9sent traitement enrichit les donn\u00e9es en ajoutant les ann\u00e9es manquantes.\n--\n-- Exemple :\n--   Donn\u00e9es brutes :\n--     1968 | Cabourg | 10 000\n--     1971 | Cabourg | 15 000\n--\n--   Donn\u00e9es finales :\n--     1968 | Cabourg | 10 000\n--     1969 | Cabourg | 10 000\n--     1970 | Cabourg | 10 000\n--     1971 | Cabourg | 15 000\n--     1972 | Cabourg | 15 000\n-- -----------------------------------------------------------------------------\n\n\n\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\nwith\n-- Selection des colonnes\ncte_stg_insee_commune_residence_principale_histo as (\n    select \n        commune_code,\n        commune_annee,\n        logements_prives_nombre\n    from \"wh_dp_silver\".\"stg\".\"stg_insee_commune_residence_principale_histo\"\n),\n\n-------------------------------------------------------------------\n--*********************** TRANSFORMATION *************************\n-------------------------------------------------------------------\n  \n-- Liste des ann\u00e9es compl\u00e8tes depuis la date min jusqu'a annee actuelle + 1\nyears as (\n    select value as commune_annee\n    from generate_series(\n        (select cast(min(commune_annee) as int) from cte_stg_insee_commune_residence_principale_histo),\n        year(getdate()) + 1\n    )\n),\n\n-- Liste unique des communes\ncommunes as (\n    select distinct commune_code from cte_stg_insee_commune_residence_principale_histo\n),\n\n-- Produit crois\u00e9 commune \u00d7 ann\u00e9e\ncombinations as (\n    select \n        y.commune_annee,\n        c.commune_code\n    from years y\n    cross join communes c\n),\n\n-- Jointure avec cte_stg_insee_commune_residence_principale_histo\njoined as (\n    select \n        comb.commune_annee,\n        comb.commune_code,\n        src.logements_prives_nombre\n    from combinations comb\n    left join cte_stg_insee_commune_residence_principale_histo src\n        on comb.commune_code = src.commune_code\n       and comb.commune_annee = src.commune_annee\n),\n\n-- Propagation des valeurs manquantes\nfilled as (\n    select\n        commune_annee,\n        commune_code,\n        max(logements_prives_nombre) over (\n            partition by commune_code\n            order by commune_annee\n            rows between unbounded preceding and current row\n        ) as logements_prives_nombre\n    from joined\n),\n\n-------------------------------------------------------------------\n--*********************** FINAL *************************\n-------------------------------------------------------------------\ncte_finale as \n(\nselect\n    *,\n    \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(commune_code as varchar(max))\n    \n)  \n \n as commune_code_hk,\n    \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n          as _meta_loaded_at\nfrom filled\n)\n\nselect \n    *\nfrom cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_commune_residence_principale_histo\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.141312Z", "completed_at": "2025-11-18T13:40:03.150645Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.151116Z", "completed_at": "2025-11-18T13:40:03.151122Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011065959930419922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_ept", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_ept\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Sources:         stg_insee_appartenance_geo_commune, stg_insee_lib_zone_supra_communale\n * Cible :          int_ept \n * Historique des modifications:\n        - SLR 06/08/2025 : suppression de l epci (car provoque des problemes de logique fonctionnelle)\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_lib_zone_supra_communale as\n(\n    select\n        geographie_annee         as ept_annee,\n        geographie_code          as ept_code,\n        geographie_libelle       as ept_libelle\n\n    from\n        \"wh_dp_silver\".\"stg\".\"stg_insee_lib_zone_supra_communale\"\n\n    where\n        geographie_niveau = 'EPT'\n       -- and\n        -- permet d'eviter d'avoir des doublons\n       -- geographie_code not like '%ZZZZ%'\n\n),\n\ncte_stg_insee_appartenance_geo_commune as \n(\n    select distinct\n         commune_annee,\n        -- epci_code,\n         ept_code\n\n    from \n         \"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_commune\"\n),\n\n-- Ajout des colonnes calcul\u00e9es\n cte_calc_stg_insee_lib_zone_supra_communale as \n (\n    select\n        t1.ept_annee                          as ept_annee,\n       -- cte_stg_insee_appartenance_geo_commune.epci_code                          as epci_code,\n        t1.ept_code                           as ept_code,\n        t1.ept_libelle                        as ept_libelle,\n        \n    case\n        when t1.ept_annee = (\n            select max(t2.ept_annee)\n            from cte_stg_insee_lib_zone_supra_communale t2\n            where t2.ept_code = t1.ept_code\n        ) then 1\n        else 0\n    end\n as ept_annee_last_flag\n\n    from\n        cte_stg_insee_lib_zone_supra_communale t1\n    \n    left join\n        cte_stg_insee_appartenance_geo_commune\n    on\n        cte_stg_insee_appartenance_geo_commune.ept_code = t1.ept_code\n    and\n        cte_stg_insee_appartenance_geo_commune.commune_annee = t1.ept_annee\n ),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_insee_lib_zone_supra_communale as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', ept_annee, ept_code) \n    \n)  \n \n as ept_hk\n        , \n    \n        concat_ws('||', ept_annee, ept_code) \n    \n as ept_bk\n        \n    from \n        cte_calc_stg_insee_lib_zone_supra_communale\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_insee_lib_zone_supra_communale\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_ept\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.153874Z", "completed_at": "2025-11-18T13:40:03.162883Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.163331Z", "completed_at": "2025-11-18T13:40:03.163338Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011143922805786133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_passage_commune_histo", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_passage_commune_histo\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          stg_insee_passage_commune\n * Cible :          int_passage_commune_histo\n \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n -- S\u00e9lection des colonnes \n  cte_stg_insee_passage_commune as \n (\n    select \n        passage_commune_annee,\n        commune_initiale_code,\n        commune_finale_code\n  \n    from \n        \"wh_dp_silver\".\"stg\".\"stg_insee_passage_commune\"\n ),\n\n  /*  cte_filter_stg_insee_passage_commune as \n (\n    select \n        passage_commune_annee,\n        commune_initiale_code,\n        commune_finale_code\n  \n    from \n       cte_stg_insee_passage_commune\n    where passage_commune_annee =\n        (\n            select max (passage_commune_annee)\n            from cte_stg_insee_passage_commune\n        )\n ),*/\n\n-- Ajout des colonnes calcul\u00e9es\n cte_calc_stg_insee_passage_commune  as \n (\n    select\n        cte_stg_insee_passage_commune.*\n        , \n    case\n        when year(passage_commune_annee) = (\n            select max(year(passage_commune_annee))\n            from cte_stg_insee_passage_commune\n        ) then 1\n        else 0\n    end\n as passage_commune_annee_last_flag\n\n\n    from \n        cte_stg_insee_passage_commune\n ),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_insee_passage_commune as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', passage_commune_annee, commune_initiale_code) \n    \n)  \n \n as commune_initiale_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', passage_commune_annee, commune_finale_code) \n    \n)  \n \n as commune_finale_hk\n\n    from \n        cte_calc_stg_insee_passage_commune\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_insee_passage_commune\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_passage_commune_histo\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.165538Z", "completed_at": "2025-11-18T13:40:03.176297Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.176775Z", "completed_at": "2025-11-18T13:40:03.176782Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012219667434692383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_departement", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_departement\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Sources:         stg_insee_appartenance_geo_commune, stg_insee_lib_zone_supra_communale\n * Cible :          int_ept \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_lib_zone_supra_communale as\n(\n    select\n        geographie_annee         as departement_annee,\n        geographie_code          as departement_code,\n        geographie_libelle       as departement_libelle\n\n    from\n        \"wh_dp_silver\".\"stg\".\"stg_insee_lib_zone_supra_communale\"\n\n    where  geographie_niveau = 'DEP'\n),\n\ncte_stg_insee_appartenance_geo_commune as \n(\n    select distinct\n         commune_annee,\n         departement_code,\n         region_code\n\n    from \n         \"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_commune\"\n),\n\n cte_map_departement_region as \n (\n    select \n        departement_code,\n        region_code_old\n       -- region_code_new as region_code\n    from   \n        \"wh_dp_bronze\".\"seed\".\"map_departement_region\"\n ),\n\n-- Ajout des colonnes calcul\u00e9es\n cte_calc_stg_insee_lib_zone_supra_communale as \n (\n    select\n        t1.departement_annee                          as departement_annee,\n        t1.departement_code                           as departement_code,\n        t1.departement_libelle                        as departement_libelle,\n        \n    case\n        when t1.departement_annee = (\n            select max(t2.departement_annee)\n            from cte_stg_insee_lib_zone_supra_communale t2\n            where t2.departement_code = t1.departement_code\n        ) then 1\n        else 0\n    end\n as departement_annee_last_flag,\n        cte_stg_insee_appartenance_geo_commune.region_code                                as region_code,\n        cte_map_departement_region.region_code_old                                       as region_av15_code\n\n    from\n        cte_stg_insee_lib_zone_supra_communale t1\n    \n    left join\n        cte_stg_insee_appartenance_geo_commune\n    on\n        cte_stg_insee_appartenance_geo_commune.departement_code = t1.departement_code\n    and\n        cte_stg_insee_appartenance_geo_commune.commune_annee = t1.departement_annee\n\n    left join \n        cte_map_departement_region\n    on \n        cte_stg_insee_appartenance_geo_commune.departement_code = cte_map_departement_region.departement_code\n  --  and\n  --      cte_stg_insee_appartenance_geo_commune.region_code = cte_map_departments_regions.region_code\n\n ),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_insee_lib_zone_supra_communale as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', departement_annee, departement_code) \n    \n)  \n \n as departement_hk\n        , \n    \n        concat_ws('||', departement_annee, departement_code) \n    \n as departement_bk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', departement_annee, region_code) \n    \n)  \n \n      as region_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', departement_annee, region_av15_code) \n    \n)  \n \n      as region_av15_hk\n    from \n        cte_calc_stg_insee_lib_zone_supra_communale\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_insee_lib_zone_supra_communale\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_departement\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.178537Z", "completed_at": "2025-11-18T13:40:03.186362Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.186815Z", "completed_at": "2025-11-18T13:40:03.186822Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009058237075805664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_region", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_region\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          stg_insee_lib_zone_supra_communale\n                    map_departments_regions\n * Cible :          int_region\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_lib_zone_supra_communale as \n(\n    select \n       geographie_code          as region_code,\n       geographie_libelle       as region_libelle,\n       geographie_annee         as region_annee,\n       geographie_niveau        as region_niveau \n\n\n    from \n        \"wh_dp_silver\".\"stg\".\"stg_insee_lib_zone_supra_communale\"\n),\n\n cte_map_ancienne_region as \n (\n    select \n        distinct \n            region_code_old     as region_code,\n            region_libelle_old  as region_libelle\n    from   \n        \"wh_dp_bronze\".\"seed\".\"map_departement_region\"\n ),\n\n-- Ajout des filters\n\n--cte_fil_stg_insee_lib_zone_supra_communale\n cte_region_actuelle as \n(\n    select \n       region_code,\n       region_libelle,\n       region_annee\n\n    from \n      cte_stg_insee_lib_zone_supra_communale\n\n    where region_niveau = 'REG'\n),\n\n-- Filtrer les anciennes r\u00e9gions (celles qui n'existent pas d\u00e9j\u00e0 dans la table actuelle)\n--cte_filtre_old_regions\ncte_region_ancienne as (\n\n    select\n        old.region_code,\n        old.region_libelle,\n        2015 as region_annee\n\n    from \n        cte_map_ancienne_region old\n\n    where not exists (\n        select 1 \n\n        from cte_region_actuelle existing\n\n        where existing.region_code = old.region_code\n       -- and existing.region_libelle = old.region_libelle\n    )\n),\n\n-- Union des regions\n--cte_filtre_stg_insee_lib_zone_supra_communale_final\ncte_all_regions as (\n    select \n        region_code,\n        region_libelle,\n        region_annee\n    from \n        cte_region_actuelle\n\n    union all\n\n    select \n        region_code,\n        region_libelle,\n        region_annee\n    from \n        cte_region_ancienne\n),\n\n\n-- Ajout des colonnes calcul\u00e9es\n\n cte_calc_stg_insee_lib_zone_supra_communale  as \n (\n    select\n            *\n            , \n    case\n        when t1.region_annee = (\n            select max(t2.region_annee)\n            from cte_all_regions t2\n            where t2.region_code = t1.region_code\n        ) then 1\n        else 0\n    end\n as region_annee_last_flag\n            , case when  region_code in ('01', '02', '03', '04', '06') then cast (1 as bit) else cast (0 as bit) end as region_outre_mer_flag \n            , case when  region_code in ('01', '02', '03', '04', '06') then 'R\u00e9gions d''Outre-mer' else 'France m\u00e9tropolitaine' end as region_outre_mer_flag_libelle \n            , case when  region_code = '11' then cast (1 as bit) else cast (0 as bit) end  as region_idf_flag\n                 \n    from \n      cte_all_regions  t1\n   \n ),\n\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_stg_insee_lib_zone_supra_communale as\n(\n    select \n        *\n       , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||',  region_annee, region_code) \n    \n)  \n \n as region_hk\n       , \n    \n        concat_ws('||',  region_annee, region_code) \n    \n as region_bk\n\n    from \n         cte_calc_stg_insee_lib_zone_supra_communale\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_stg_insee_lib_zone_supra_communale\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_region\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.188927Z", "completed_at": "2025-11-18T13:40:03.198202Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.198689Z", "completed_at": "2025-11-18T13:40:03.198697Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011142253875732422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_epci", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_epci\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          stg_insee_epci, map_epci_nature_code\n * Cible :          int_epci \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_epci as \n(\n    select \n        epci_annee,\n        epci_code,\n        epci_libelle,\n        epci_nature_code\n\n    from \n        \"wh_dp_silver\".\"stg\".\"stg_insee_epci\"\n),\n\ncte_map_epci_nature_code as\n(\n    select\n        epci_nature_code_source,\n        epci_nature_code_cible       \n    from\n        \"wh_dp_bronze\".\"seed\".\"map_epci_nature_code\"\n),\n\n-- Ajout des colonnes calcul\u00e9es\n cte_calc_stg_insee_epci  as \n (\n    select\n        t1.epci_annee                             as epci_annee,\n        t1.epci_code                              as epci_code,\n        case \n\t\t\twhen t1.epci_libelle like 'Communaut\u00e9 urbaine%' then replace (t1.epci_libelle, 'Communaut\u00e9 urbaine', 'CU')\n\t\t\twhen t1.epci_libelle like 'Communaut\u00e9 d''agglom\u00e9ration%' then replace (t1.epci_libelle, 'Communaut\u00e9 d''agglom\u00e9ration', 'CA')\n\t\t\twhen t1.epci_libelle like 'Communaut\u00e9 de communes%' then replace (t1.epci_libelle, 'Communaut\u00e9 de communes', 'CC')\n\t\t\telse t1.epci_libelle\n\t\tend AS epci_libelle, \n        cte_map_epci_nature_code.epci_nature_code_cible           as epci_nature_code\n        , \n    case\n        when t1.epci_annee = (\n            select max(t2.epci_annee)\n            from \"wh_dp_silver\".\"stg\".\"stg_insee_epci\" t2\n            where t2.epci_code = t1.epci_code\n        ) then 1\n        else 0\n    end\n as epci_annee_last_flag\n\n    from \n        cte_stg_insee_epci t1\n    \n    left join\n        cte_map_epci_nature_code\n    on\n        t1.epci_nature_code = cte_map_epci_nature_code.epci_nature_code_source\n ),\n\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_insee_epci as\n(\n    select \n        *\n        , \n    \n        concat_ws('||', epci_annee, epci_code) \n    \n as epci_bk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', epci_annee, epci_code) \n    \n)  \n \n as epci_hk\n    from \n        cte_calc_stg_insee_epci\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_insee_epci\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_epci\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.200382Z", "completed_at": "2025-11-18T13:40:03.209101Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.209628Z", "completed_at": "2025-11-18T13:40:03.209636Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010165691375732422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_patrimoine_sortie", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_patrimoine_sortie\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          patrimoine_sortie\n * Cible :          dim_patrimoine_sortie\n * Dimension cr\u00e9\u00e9e a partir de la table de mapping map_patrimoine_sortie\n * Le patrimoine_sortie qu'on affiche est une aggr\u00e9gation du patrimoins sortie qu'on a en source\n */\n\n\n\n\n-- Selection des tables et des colonnes\nwith cte_map_patrimoine_sortie as\n(\n    select \n        patrimoine_sortie_code_gold\n        , patrimoine_sortie_gold_libelle\n    from   \n        \"wh_dp_bronze\".\"seed\".\"map_patrimoine_sortie\"\n),\n\ncte_default_values as \n(\n    select\n        'N/A'               as patrimoine_sortie_code,\n        'Mise en service'   as patrimoine_sortie_libelle\n),\n\n-- Filtre, union et renommage\ncte_dim_patrimoine_sortie as \n(\n    select distinct\n        patrimoine_sortie_code_gold                as patrimoine_sortie_code,\n        patrimoine_sortie_gold_libelle             as patrimoine_sortie_libelle\n        \n    from \n        cte_map_patrimoine_sortie\n\n    union all\n    \n    select \n        patrimoine_sortie_code,\n        patrimoine_sortie_libelle\n    from cte_default_values  \n),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_dim_patrimoine_sortie as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(patrimoine_sortie_code as varchar(max))\n    \n)  \n \n   as patrimoine_sortie_hk\n         \n\n    from \n        cte_dim_patrimoine_sortie\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_dim_patrimoine_sortie\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_patrimoine_sortie\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.211662Z", "completed_at": "2025-11-18T13:40:03.220775Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.221288Z", "completed_at": "2025-11-18T13:40:03.221295Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010491371154785156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.construction_type", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table construction_type\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          construction_type\n */\n\n\n\n-- Selection des tables et des colonnes\nwith cte_ref_dataplatform as\n(\n    select \n        objet,\n        code, \n        libelle,\n        val1\n    from   \n        \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n),\n\n-- Filtre et renommage\ncte_construction_type as \n(\n    select \n        code                as construction_type_code,\n        libelle             as construction_type_libelle,\n        val1                as construction_type_libelle_court\n    from \n        cte_ref_dataplatform\n    where \n        objet = 'construction_type'\n    \n    union all\n\n    select\n        'N/A'          as construction_type_code,\n        'Non disponible'  as construction_type_libelle,\n        'Non disponible'  as construction_type_libelle_court\n \n),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_construction_type as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(construction_type_code as varchar(max))\n    \n)  \n \n   as construction_type_hk\n         \n\n    from \n        cte_construction_type\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_construction_type\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"construction_type\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.222740Z", "completed_at": "2025-11-18T13:40:03.230607Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.231064Z", "completed_at": "2025-11-18T13:40:03.231070Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009019136428833008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_construction_periode", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_construction_periode\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          dim_construction_periode\n */\n\n\n\n-- Selection des tables et des colonnes\nwith cte_ref_dataplatform as\n(\n    select \n        objet,\n        code, \n        libelle,\n        val1,\n        val2\n    from   \n        \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n),\n\n-- Filtrage, renommage, typage\ncte_dim_construction_periode as \n(\n    select \n        code                as construction_periode_code,\n        libelle             as construction_periode_libelle,\n        cast(val1 as int)   as construction_periode_min,\n        cast(val2 as int)   as construction_periode_max\n    from \n        cte_ref_dataplatform\n    where \n        objet = 'dim_construction_periode'\n),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_dim_construction_periode as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(construction_periode_code as varchar(max))\n    \n)  \n \n   as construction_periode_hk\n         \n\n    from \n        cte_dim_construction_periode\n),\n\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_dim_construction_periode\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_construction_periode\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.232392Z", "completed_at": "2025-11-18T13:40:03.241190Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.241672Z", "completed_at": "2025-11-18T13:40:03.241682Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00990748405456543, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_organisme_famille", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_organisme_famille\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          dim_organisme_famille\n */\n\n\n\n-- Selection des tables et des colonnes\nwith cte_ref_dataplatform as\n(\n    select \n        objet,\n        code, \n        libelle,\n        val1,\n        val2\n    from   \n        \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n),\n\n-- Filtre et renommage\ncte_dim_organisme_famille as \n(\n    select \n        code                as organisme_famille_code,\n        libelle             as organisme_famille_libelle,\n        cast(val1 as bit)   as hlm_flag,\n        cast(val2 as int)   as display_order\n    from \n        cte_ref_dataplatform\n    where \n        objet = 'dim_organisme_famille'\n),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_dim_organisme_famille as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_famille_code as varchar(max))\n    \n)  \n \n   as organisme_famille_hk\n         \n\n    from \n        cte_dim_organisme_famille\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_dim_organisme_famille\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_organisme_famille\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.243138Z", "completed_at": "2025-11-18T13:40:03.251184Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.251635Z", "completed_at": "2025-11-18T13:40:03.251642Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00911712646484375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dpe_energie", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dpe_energie\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          dpe_energie\n */\n\n\n\n    \n    \n    \n    select\n        code as dpe_energie_code,\n        libelle as dpe_energie_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as dpe_energie_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'dpe_energie'\n    \n    union all\n\n    select\n        'N/A' as dpe_energie_code,\n        'Non disponible' as dpe_energie_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as dpe_energie_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"dpe_energie\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.253760Z", "completed_at": "2025-11-18T13:40:03.262270Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.262706Z", "completed_at": "2025-11-18T13:40:03.262712Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010340213775634766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dpe_ges", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dpe_ges\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          dpe_ges\n */\n\n\n\n\n    \n    \n    \n    select\n        code as dpe_ges_code,\n        libelle as dpe_ges_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as dpe_ges_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'dpe_ges'\n    \n    union all\n\n    select\n        'N/A' as dpe_ges_code,\n        'Non disponible' as dpe_ges_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as dpe_ges_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"dpe_ges\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.264348Z", "completed_at": "2025-11-18T13:40:03.273313Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.273820Z", "completed_at": "2025-11-18T13:40:03.273827Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010344743728637695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.epci_nature", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table epci_nature\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          ref_dataplatform\n * Cible :          epci_nature\n */\n\n\n\n\n\n    \n    \n    \n    select\n        code as epci_nature_code,\n        libelle as epci_nature_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as epci_nature_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'epci_nature'\n    \n    union all\n\n    select\n        'N/A' as epci_nature_code,\n        'Non disponible' as epci_nature_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as epci_nature_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"epci_nature\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.275255Z", "completed_at": "2025-11-18T13:40:03.282222Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.282681Z", "completed_at": "2025-11-18T13:40:03.282688Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008137702941894531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.financement_groupe", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table financement_groupe\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          financement_groupe\n */\n\n\n\n\n    \n    \n    \n    select\n        code as financement_groupe_code,\n        libelle as financement_groupe_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as financement_groupe_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'financement_groupe'\n    \n    union all\n\n    select\n        'N/A' as financement_groupe_code,\n        'Non disponible' as financement_groupe_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as financement_groupe_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"financement_groupe\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.284679Z", "completed_at": "2025-11-18T13:40:03.292175Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.292661Z", "completed_at": "2025-11-18T13:40:03.292668Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009226322174072266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.financement_initial", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table financement_initial\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          financement_initial\n */\n\n\n\n\n    \n    \n    \n    select\n        code as financement_initial_code,\n        libelle as financement_initial_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as financement_initial_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'financement_initial'\n    \n    union all\n\n    select\n        'N/A' as financement_initial_code,\n        'Non disponible' as financement_initial_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as financement_initial_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"financement_initial\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.294205Z", "completed_at": "2025-11-18T13:40:03.301585Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.302054Z", "completed_at": "2025-11-18T13:40:03.302061Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00854349136352539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.immobilier_droit", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table immobilier_droit\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          immobilier_droit\n */\n\n\n\n\n    \n    \n    \n    select\n        code as immobilier_droit_code,\n        libelle as immobilier_droit_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as immobilier_droit_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'immobilier_droit'\n    \n    union all\n\n    select\n        'N/A' as immobilier_droit_code,\n        'Non disponible' as immobilier_droit_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as immobilier_droit_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"immobilier_droit\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.303393Z", "completed_at": "2025-11-18T13:40:03.311273Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.311723Z", "completed_at": "2025-11-18T13:40:03.311730Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008954048156738281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.occupation_mode", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table occupation_mode\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          occupation_mode\n */\n\n\n\n\n    \n    \n    \n    select\n        code as occupation_mode_code,\n        libelle as occupation_mode_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as occupation_mode_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'occupation_mode'\n    \n    union all\n\n    select\n        'N/A' as occupation_mode_code,\n        'Non disponible' as occupation_mode_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as occupation_mode_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"occupation_mode\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.313639Z", "completed_at": "2025-11-18T13:40:03.321889Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.322348Z", "completed_at": "2025-11-18T13:40:03.322355Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009903192520141602, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.organisme_categorie", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table organisme_categorie\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          organisme_categorie\n */\n\n\n\n\n    \n    \n    \n    select\n        code as organisme_categorie_code,\n        libelle as organisme_categorie_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as organisme_categorie_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'organisme_categorie'\n    \n    union all\n\n    select\n        'N/A' as organisme_categorie_code,\n        'Non disponible' as organisme_categorie_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as organisme_categorie_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"organisme_categorie\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.323659Z", "completed_at": "2025-11-18T13:40:03.331488Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.331934Z", "completed_at": "2025-11-18T13:40:03.331941Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008875131607055664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.patrimoine_origine", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table patrimoine_origine\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          patrimoine_origine\n */\n\n\n\n\n    \n    \n    \n    select\n        code as patrimoine_origine_code,\n        libelle as patrimoine_origine_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as patrimoine_origine_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'patrimoine_origine'\n    \n    union all\n\n    select\n        'N/A' as patrimoine_origine_code,\n        'Non disponible' as patrimoine_origine_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as patrimoine_origine_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"patrimoine_origine\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.333401Z", "completed_at": "2025-11-18T13:40:03.340836Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.341258Z", "completed_at": "2025-11-18T13:40:03.341265Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008560419082641602, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.patrimoine_sortie", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table patrimoine_sortie\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          patrimoine_sortie\n */\n\n\n\n\n    \n    \n    \n    select\n        code as patrimoine_sortie_code,\n        libelle as patrimoine_sortie_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as patrimoine_sortie_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'patrimoine_sortie'\n    \n    union all\n\n    select\n        'N/A' as patrimoine_sortie_code,\n        'Non disponible' as patrimoine_sortie_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as patrimoine_sortie_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"patrimoine_sortie\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.342600Z", "completed_at": "2025-11-18T13:40:03.352515Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.352970Z", "completed_at": "2025-11-18T13:40:03.352976Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010976076126098633, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.piece_nombre", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table piece_nombre\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          piece_nombre\n */\n\n\n\n-- Selection des tables et des colonnes\nwith cte_ref_dataplatform as\n(\n    select \n        objet,\n        code, \n        libelle,\n        val1\n    from   \n        \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n),\n\n-- Filtre et renommage\ncte_piece_nombre as \n(\n    select \n        code                as piece_nombre_code,\n        libelle             as piece_nombre_libelle,\n        val1                as piece_nombre_libelle_bis\n    from \n        cte_ref_dataplatform\n    where \n        objet = 'piece_nombre'\n    \n    union all\n\n    select\n        'N/A'          as piece_nombre_code,\n        'Non disponible'  as piece_nombre_libelle,\n        'Non disponible'  as piece_nombre_libelle_bis\n \n),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_piece_nombre as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(piece_nombre_code as varchar(max))\n    \n)  \n \n   as piece_nombre_hk\n         \n\n    from \n        cte_piece_nombre\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_piece_nombre\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"piece_nombre\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.354994Z", "completed_at": "2025-11-18T13:40:03.362949Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.363386Z", "completed_at": "2025-11-18T13:40:03.363393Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009664297103881836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.pmr", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table pmr\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          pmr\n */\n\n\n\n\n    \n    \n    \n    select\n        code as pmr_code,\n        libelle as pmr_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as pmr_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'pmr'\n    \n    union all\n\n    select\n        'N/A' as pmr_code,\n        'Non disponible' as pmr_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as pmr_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"pmr\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.365195Z", "completed_at": "2025-11-18T13:40:03.373558Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.374002Z", "completed_at": "2025-11-18T13:40:03.374009Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009881258010864258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.reservation_contingent", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table reservation_contingent\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          reservation_contingent\n */\n\n\n\n\n    \n    \n    \n    select\n        code as reservation_contingent_code,\n        libelle as reservation_contingent_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as reservation_contingent_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'reservation_contingent'\n    \n    union all\n\n    select\n        'N/A' as reservation_contingent_code,\n        'Non disponible' as reservation_contingent_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as reservation_contingent_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"reservation_contingent\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.375302Z", "completed_at": "2025-11-18T13:40:03.383283Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.383728Z", "completed_at": "2025-11-18T13:40:03.383733Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009015798568725586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.surface_calcul_mode", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table surface_calcul_mode\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          surface_calcul_mode\n */\n\n\n\n\n    \n    \n    \n    select\n        code as surface_calcul_mode_code,\n        libelle as surface_calcul_mode_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as surface_calcul_mode_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'surface_calcul_mode'\n    \n    union all\n\n    select\n        'N/A' as surface_calcul_mode_code,\n        'Non disponible' as surface_calcul_mode_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as surface_calcul_mode_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"surface_calcul_mode\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.385012Z", "completed_at": "2025-11-18T13:40:03.392962Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.393420Z", "completed_at": "2025-11-18T13:40:03.393426Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009000301361083984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.vente_type", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table vente_type\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          ref_dataplatform\n * Cible :          vente_type\n */\n\n\n\n\n    \n    \n    \n    select\n        code as vente_type_code,\n        libelle as vente_type_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as vente_type_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'vente_type'\n    \n    union all\n\n    select\n        'N/A' as vente_type_code,\n        'Non disponible' as vente_type_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as vente_type_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"vente_type\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.394702Z", "completed_at": "2025-11-18T13:40:03.402434Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.402885Z", "completed_at": "2025-11-18T13:40:03.402891Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008773565292358398, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.zone_123", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table zone_123\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          ref_dataplatform\n * Cible :          zone_123\n */\n\n\n\n\n\n    \n    \n    \n    select\n        code as zone_123_code,\n        libelle as zone_123_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as zone_123_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'zone_123'\n    \n    union all\n\n    select\n        'N/A' as zone_123_code,\n        'Non disponible' as zone_123_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as zone_123_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"zone_123\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.404875Z", "completed_at": "2025-11-18T13:40:03.412589Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.413046Z", "completed_at": "2025-11-18T13:40:03.413053Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009426593780517578, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.zone_abc", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table zone_abc\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_zone_abc\n * Cible :          zone_abc\n */\n\n\n\n\n    \n    \n    \n    select\n        code as zone_abc_code,\n        libelle as zone_abc_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(code as varchar(max))\n    \n)  \n \n as zone_abc_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n    where objet = 'zone_abc'\n    \n    union all\n\n    select\n        'N/A' as zone_abc_code,\n        'Non disponible' as zone_abc_libelle,\n        \n     \n        HASHBYTES('SHA2_256', \n    \n        cast('N/A' as varchar(max))\n    \n)  \n \n as zone_abc_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n", "relation_name": "\"wh_dp_silver\".\"dbo\".\"zone_abc\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.415082Z", "completed_at": "2025-11-18T13:40:03.423535Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.424058Z", "completed_at": "2025-11-18T13:40:03.424065Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010265350341796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.organisme", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table organisme\n * Fr\u00e9quence :      Quotidienne\n * Mode :           Annule et remplace\n * Source:          int_organisme\n * Cible :          organisme\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_organisme as\n(\n    select\n        organisme_raison_sociale_libelle,\n        organisme_statut_code,\n        organisme_type_code,\n        organisme_siren_code,\n        organisme_sous_famille_code,\n        organisme_code_union,\n        organisme_id_code,\n        organisme_hk,\n        organisme_statut_hk,\n        organisme_type_hk,\n        organisme_sous_famille_hk\n\n\n    from \"wh_dp_silver\".\"int\".\"int_organisme\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    \n    from cte_int_organisme\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"organisme\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.425571Z", "completed_at": "2025-11-18T13:40:03.433123Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.433562Z", "completed_at": "2025-11-18T13:40:03.433569Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008695125579833984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.qpv", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table qpv\n * Fr\u00e9quence :      Annuel\n * Mode :           Full refresh / overwrite\n * Source:          int_qpv\n * Cible :          qpv\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_qpv as\n(\n    select\n        qpv_hk,\n        qpv_bk,\n        qpv_annee,\n        qpv_annee_last_flag,\n        qpv_code,\n        qpv_libelle\n\n    from \"wh_dp_silver\".\"int\".\"int_qpv\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from cte_int_qpv\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"qpv\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.435006Z", "completed_at": "2025-11-18T13:40:03.444476Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.445102Z", "completed_at": "2025-11-18T13:40:03.445110Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010785818099975586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.qpv_commune", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table de correspondance qpv_commune\n * Fr\u00e9quence :      Annuel\n * Mode :           Full refresh / overwrite\n * Source:          int_qpv_commune\n * Cible :          qpv_commune \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_qpv_commune as\n(\n    select\n        qpv_commune_bk,\n        qpv_commune_hk,\n        qpv_commune_annee,\n        qpv_commune_annee_last_flag,\n        qpv_code,\n        --qpv_libelle,\n        commune_code,\n        qpv_hk,\n        commune_hk\n\n    from \"wh_dp_silver\".\"int\".\"int_qpv_commune\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from cte_int_qpv_commune\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"qpv_commune\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.446836Z", "completed_at": "2025-11-18T13:40:03.455355Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.455832Z", "completed_at": "2025-11-18T13:40:03.455839Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009813547134399414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.arrondissement", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table arrondissement\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_arrondissement\n * Cible :          arrondissement\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_arrondissement as\n(\n    select\n        arrondissement_annee,\n        arrondissement_annee_last_flag,\n        arrondissement_code,\n        arrondissement_hk,\n        arrondissement_bk,\n        arrondissement_libelle,\n        commune_hk\n\n    from \"wh_dp_silver\".\"int\".\"int_arrondissement\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    \n    from cte_int_arrondissement\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"arrondissement\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.457370Z", "completed_at": "2025-11-18T13:40:03.467519Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.467986Z", "completed_at": "2025-11-18T13:40:03.467992Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011363029479980469, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_quartier_iris", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_quartier_iris\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Full refresh / overwrite\n * Source:          stg_insee_appartenance_geo_iris\n * Cible :          int_quartier_iris\n * Un quartier IRIS ne peut appartenir qu'\u00e0 une seule commune, contrairement au QPV\n * Un quartier IRIS ne peut appartenir qu'\u00e0 un seul arrondissement \n * Le champ geographie_code est soit un arrondissement, soit une commune\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_appartenance_geo_iris as \n(\n    select \n        quartier_iris_annee,\n        quartier_iris_code ,\n        quartier_iris_libelle,\n        geographie_code\n        \n    from \n        \"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_iris\"\n),\n\ncte_int_arrondissement as \n(\n    select \n        arrondissement_annee,\n        arrondissement_code,\n        commune_code\n    from \n        \"wh_dp_silver\".\"int\".\"int_arrondissement\"\n),\n\n-- Filtres\n-- Exclusion des g\u00e9ographies hors scope\ncte_filter_stg_insee_appartenance_geo_iris as \n(\n    select \n        *\n        \n    from \n        cte_stg_insee_appartenance_geo_iris\n\n    where not (geographie_code like '98%' or geographie_code like '975%' or geographie_code like '977%' or geographie_code like '978%')\n),\n\n-- Ajout des colonnes calcul\u00e9es\ncte_calc_stg_insee_appartenance_geo_iris  as \n (\n    select\n        quartier_iris_annee,\n        quartier_iris_code,\n        quartier_iris_libelle,\n        isnull(int_arrondissement.commune_code, t1.geographie_code)                                 \n            as commune_code,\n        isnull(int_arrondissement.arrondissement_code,'N/A')                                                                              \n            as arrondissement_code,\n        \n    case\n        when t1.quartier_iris_annee = (\n            select max(t2.quartier_iris_annee)\n            from cte_stg_insee_appartenance_geo_iris t2\n            where t2.quartier_iris_code = t1.quartier_iris_code\n        ) then 1\n        else 0\n    end\n as quartier_iris_annee_last_flag\n    from \n        cte_filter_stg_insee_appartenance_geo_iris t1\n    -- geographie_code peut etre soit une commune soit un arrondissement\n    left join cte_int_arrondissement int_arrondissement\n        on  t1.geographie_code = int_arrondissement.arrondissement_code\n        and t1.quartier_iris_annee = int_arrondissement.arrondissement_annee\n            \n    \n ),\n\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_stg_insee_appartenance_geo_iris as\n(\n    select \n        *\n        , \n    \n        concat_ws('||', quartier_iris_annee, quartier_iris_code) \n    \n as quartier_iris_bk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', quartier_iris_annee, quartier_iris_code) \n    \n)  \n \n as quartier_iris_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', quartier_iris_annee, commune_code) \n    \n)  \n \n as commune_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', quartier_iris_annee, arrondissement_code) \n    \n)  \n \n as arrondissement_hk\n    from \n        cte_calc_stg_insee_appartenance_geo_iris\n),\n \n-- Ajout des m\u00e9tadonn\u00e9es\n \n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_stg_insee_appartenance_geo_iris\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_quartier_iris\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.469516Z", "completed_at": "2025-11-18T13:40:03.480453Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.480898Z", "completed_at": "2025-11-18T13:40:03.480904Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012189626693725586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_commune", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_commune\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Sources:         stg_insee_appartenance_geo_commune\n * Cible :          int_ept \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_stg_insee_appartenance_geo_commune as \n(\n    select\n         commune_annee,\n         commune_code,\n         commune_libelle,\n         departement_code,\n         epci_code,\n         ept_code\n\n    from \n         \"wh_dp_silver\".\"stg\".\"stg_insee_appartenance_geo_commune\"\n),\n\ncte_transform_stg_insee_appartenance_geo_commune as\n(\n    select\n         commune_annee,\n         commune_code,\n         commune_libelle,\n         departement_code,\n         epci_code,\n         ept_code\n    from \n         cte_stg_insee_appartenance_geo_commune\n),\n\ncte_stg_ministere_zone_123 as\n(\n    select\n        commune_code\n        ,zone_123_code\n    \n    from \n         \"wh_dp_silver\".\"stg\".\"stg_ministere_zone_123\"\n),\n\ncte_stg_ministere_zone_abc as\n(\n    select\n        commune_code\n        ,zone_abc_code\n    from \n         \"wh_dp_silver\".\"stg\".\"stg_ministere_zone_abc\"\n),\n\ncte_int_commune_residence_principale_histo as\n(\n    select\n        commune_annee,\n        commune_code,\n        logements_prives_nombre \n    \n    from \n         \"wh_dp_silver\".\"int\".\"int_commune_residence_principale_histo\"\n),\n\n-- Ajout des colonnes calcul\u00e9es\n cte_calc_stg_insee_appartenance_geo_commune as \n (\n    select\n        t1.*\n        , isnull(zone_123_code,'N/A') as zone_123_code\n        , isnull(zone_abc_code,'N/A') as zone_abc_code\n        , logements_prives_nombre\n        -- ajouter pour la partie dataviz: permet de localiser les communes sur une carte\n        , concat (commune_libelle,', France') as commune_pays_libelle\n        , \n    case\n        when t1.commune_annee = (\n            select max(t2.commune_annee)\n            from cte_transform_stg_insee_appartenance_geo_commune t2\n            where t2.commune_code = t1.commune_code\n        ) then 1\n        else 0\n    end\n as commune_annee_last_flag\n\n    from\n        --important ici de mettre l'alias t1\n        cte_transform_stg_insee_appartenance_geo_commune t1   \n\n    left join\n        cte_stg_ministere_zone_123 zone_123\n    on\n        zone_123.commune_code = t1.commune_code\n\n    left join\n        cte_stg_ministere_zone_abc zone_abc\n    on\n        zone_abc.commune_code = t1.commune_code\n\n     left join\n        cte_int_commune_residence_principale_histo rp\n    on\n        rp.commune_code = t1.commune_code and\n        rp.commune_annee = t1.commune_annee\n ),\n\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_insee_appartenance_geo_commune as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', commune_annee, commune_code) \n    \n)  \n \n       as commune_hk\n        , \n    \n        concat_ws('||', commune_annee, commune_code) \n    \n   as commune_bk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', commune_annee, departement_code) \n    \n)  \n \n   as departement_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', commune_annee, epci_code) \n    \n)  \n \n          as epci_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        concat_ws('||', commune_annee, ept_code) \n    \n)  \n \n           as ept_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(zone_123_code as varchar(max))\n    \n)  \n \n                       as zone_123_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(zone_abc_code as varchar(max))\n    \n)  \n \n                       as zone_abc_hk\n    from \n        cte_calc_stg_insee_appartenance_geo_commune\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_insee_appartenance_geo_commune\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_commune\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.482304Z", "completed_at": "2025-11-18T13:40:03.491090Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.491523Z", "completed_at": "2025-11-18T13:40:03.491529Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00992441177368164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.ept", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table ept\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_epci\n * Cible :          epci \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_ept as\n(\n    select\n        ept_annee,\n        ept_annee_last_flag,\n        ept_code,\n        ept_libelle,\n        ept_hk,\n        ept_bk\n        --epci_code,\n        --epci_hk\n\n    from \"wh_dp_silver\".\"int\".\"int_ept\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from cte_int_ept\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"ept\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.493704Z", "completed_at": "2025-11-18T13:40:03.502058Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.502591Z", "completed_at": "2025-11-18T13:40:03.502598Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010350704193115234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.passage_commune_histo", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table passage_commune_histo\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_passage_commune_histo\n * Cible :          passage_commune_histo\n\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_passage_commune_histo as\n(\n    select\n        passage_commune_annee,\n        passage_commune_annee_last_flag,\n        commune_initiale_hk,\n        commune_initiale_code,\n        commune_finale_hk,\n        commune_finale_code\n\n    from \"wh_dp_silver\".\"int\".\"int_passage_commune_histo\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from cte_int_passage_commune_histo\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"passage_commune_histo\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.504029Z", "completed_at": "2025-11-18T13:40:03.511718Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.512168Z", "completed_at": "2025-11-18T13:40:03.512175Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008787155151367188, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.departement", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table departement\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_departement\n * Cible :          departement\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_departement as\n(\n    select\n        departement_annee,\n        departement_annee_last_flag,\n        departement_code,\n        departement_libelle,\n        departement_hk,\n        departement_bk,\n        region_hk,\n        region_code,\n        region_av15_hk,\n        region_av15_code\n\n    from \"wh_dp_silver\".\"int\".\"int_departement\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    \n    from cte_int_departement\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\n    \nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"departement\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.514242Z", "completed_at": "2025-11-18T13:40:03.521859Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.522315Z", "completed_at": "2025-11-18T13:40:03.522325Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009378433227539062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.region", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table region\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_region\n * Cible :          region \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_region as\n(\n    select\n        region_annee,\n        region_annee_last_flag,\n        region_code,\n        region_libelle,\n        region_hk,\n        region_bk,\n        region_idf_flag,\n        region_outre_mer_flag,\n        region_outre_mer_flag_libelle\n\n    from \"wh_dp_silver\".\"int\".\"int_region\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from cte_int_region\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"region\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.524173Z", "completed_at": "2025-11-18T13:40:03.531766Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.532291Z", "completed_at": "2025-11-18T13:40:03.532298Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00902104377746582, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.epci", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table epci\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_epci\n * Cible :          epci \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_ecpi as\n(\n    select\n        epci_annee,\n        epci_annee_last_flag,\n        epci_code,\n        epci_libelle,\n        epci_nature_code,\n        epci_bk,\n        epci_hk\n\n    from \"wh_dp_silver\".\"int\".\"int_epci\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from cte_int_ecpi\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"epci\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.534918Z", "completed_at": "2025-11-18T13:40:03.542405Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.542872Z", "completed_at": "2025-11-18T13:40:03.542879Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009744405746459961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_construction_type", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_construction_type\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          construction_type\n * Cible :          dim_construction_type \n */\n\n\n \n-- Selection des tables et des colonnes\nwith cte_construction_type as\n(\n    select \n        construction_type_hk\n        , construction_type_code\n        , construction_type_libelle\n        , construction_type_libelle_court\n    from   \n        \"wh_dp_silver\".\"dbo\".\"construction_type\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_construction_type\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_construction_type\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.544258Z", "completed_at": "2025-11-18T13:40:03.551568Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.552143Z", "completed_at": "2025-11-18T13:40:03.552150Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008505821228027344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_dpe_energie", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_dpe_energie\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          dpe_energie\n * Cible :          dim_dpe_energie \n */\n\n\n\n\n\n    select\n        dpe_energie_code,\n        dpe_energie_libelle,\n        dpe_energie_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_silver\".\"dbo\".\"dpe_energie\"\n", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_dpe_energie\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.553451Z", "completed_at": "2025-11-18T13:40:03.561613Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.562053Z", "completed_at": "2025-11-18T13:40:03.562060Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009207725524902344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_dpe_ges", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_dpe_ges\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          dpe_ges\n * Cible :          dim_dpe_ges \n */\n\n\n\n\n\n    select\n        dpe_ges_code,\n        dpe_ges_libelle,\n        dpe_ges_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_silver\".\"dbo\".\"dpe_ges\"\n", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_dpe_ges\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.563473Z", "completed_at": "2025-11-18T13:40:03.571291Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.571746Z", "completed_at": "2025-11-18T13:40:03.571753Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008922815322875977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_financement_groupe", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_financement_groupe\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          financement_groupe \n * Cible :          dim_financement_groupe \n */\n\n\n\n\n\n    select\n        financement_groupe_code,\n        financement_groupe_libelle,\n        financement_groupe_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_silver\".\"dbo\".\"financement_groupe\"\n", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_financement_groupe\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.573078Z", "completed_at": "2025-11-18T13:40:03.581287Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.581738Z", "completed_at": "2025-11-18T13:40:03.581744Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009265422821044922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_occupation_mode", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_occupation_mode\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          occupation_mode\n * Cible :          dim_occupation_mode\n */\n\n\n\n\n\n    select\n        occupation_mode_code,\n        occupation_mode_libelle,\n        occupation_mode_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_silver\".\"dbo\".\"occupation_mode\"\n", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_occupation_mode\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.583071Z", "completed_at": "2025-11-18T13:40:03.590744Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.591193Z", "completed_at": "2025-11-18T13:40:03.591199Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008760213851928711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_patrimoine_origine", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_patrimoine_origine\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          patrimoine_origine  \n * Cible :          dim_patrimoine_origine \n */\n\n\n\n\n\n    select\n        patrimoine_origine_code,\n        patrimoine_origine_libelle,\n        patrimoine_origine_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_silver\".\"dbo\".\"patrimoine_origine\"\n", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_patrimoine_origine\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.593199Z", "completed_at": "2025-11-18T13:40:03.600840Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.601304Z", "completed_at": "2025-11-18T13:40:03.601310Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009093046188354492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_piece_nombre", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_piece_nombre\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          piece_nombre\n * Cible :          dim_piece_nombre\n*/\n\n\n\n\n-- Selection des tables et des colonnes\nwith cte_piece_nombre as\n(\n    select \n        piece_nombre_hk\n        , piece_nombre_code\n        , piece_nombre_libelle\n        , piece_nombre_libelle_bis\n    from   \n        \"wh_dp_silver\".\"dbo\".\"piece_nombre\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_piece_nombre\n)\n\n \nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_piece_nombre\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.602608Z", "completed_at": "2025-11-18T13:40:03.610471Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.610920Z", "completed_at": "2025-11-18T13:40:03.610927Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008956670761108398, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_pmr", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_pmr\n * Fr\u00e9quence :      Annuel\n * Mode :           Annule et remplace\n * Source:          pmr\n * Cible :          dim_pmr\n */\n\n\n\n\n\n    select\n        pmr_code,\n        pmr_libelle,\n        pmr_hk,\n        \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \"wh_dp_silver\".\"dbo\".\"pmr\"\n", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_pmr\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.612335Z", "completed_at": "2025-11-18T13:40:03.620609Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.621059Z", "completed_at": "2025-11-18T13:40:03.621065Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00933074951171875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_zone_123", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table epci\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          zone_123\n * Cible :          dim_zone_123 \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_zone_123 as\n(\n    select \n        zone_123_code,\n        zone_123_libelle\n    \n    from\n        \"wh_dp_silver\".\"dbo\".\"zone_123\"\n\n),\n\n-- Ajout des cl\u00e9s techniques (diff\u00e9rentes de la couche silver car sans ann\u00e9e )\ncte_hk_zone_123 as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(zone_123_code as varchar(max))\n    \n)  \n \n       as zone_123_hk\n \n\n    from \n        cte_zone_123\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_zone_123\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_zone_123\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.622361Z", "completed_at": "2025-11-18T13:40:03.628968Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.629460Z", "completed_at": "2025-11-18T13:40:03.629468Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007696866989135742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_zone_abc", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table epci\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          zone_abc\n * Cible :          dim_zone_abc \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_zone_abc as\n(\n    select \n        zone_abc_code,\n        zone_abc_libelle\n    \n    from\n        \"wh_dp_silver\".\"dbo\".\"zone_abc\"\n\n),\n\n-- Ajout des cl\u00e9s techniques (diff\u00e9rentes de la couche silver car sans ann\u00e9e )\ncte_hk_zone_abc as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(zone_abc_code as varchar(max))\n    \n)  \n \n       as zone_abc_hk\n \n\n    from \n        cte_zone_abc\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_zone_abc\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_zone_abc\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.630773Z", "completed_at": "2025-11-18T13:40:03.638991Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.639449Z", "completed_at": "2025-11-18T13:40:03.639455Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009274482727050781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.quartier_iris", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table quartier iris\n * Fr\u00e9quence :      Annuel\n * Mode :           Full refresh / overwrite\n * Source:          int_quartier_iris\n * Cible :          quartier_iris\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_quartier_iris as\n(\n    select\n        quartier_iris_hk,\n        quartier_iris_bk,\n        quartier_iris_annee,\n        quartier_iris_annee_last_flag,\n        quartier_iris_code,\n        quartier_iris_libelle,\n        commune_code,\n        commune_hk,\n        arrondissement_code,\n        arrondissement_hk\n\n    from \"wh_dp_silver\".\"int\".\"int_quartier_iris\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from cte_int_quartier_iris\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"quartier_iris\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.641228Z", "completed_at": "2025-11-18T13:40:03.648829Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.649273Z", "completed_at": "2025-11-18T13:40:03.649280Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008891582489013672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.commune", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table commune\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_commune\n * Cible :          commune \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_int_commune as\n(\n    select\n        commune_annee,\n        commune_annee_last_flag,\n        commune_code,\n        commune_libelle,\n        commune_pays_libelle,\n        commune_hk,\n        commune_bk,\n        departement_code,\n        departement_hk,\n        epci_code,\n        epci_hk,\n        ept_code,\n        ept_hk,\n        zone_123_code,\n        zone_123_hk,\n        zone_abc_code,\n        zone_abc_hk,\n        logements_prives_nombre\n\n    from \"wh_dp_silver\".\"int\".\"int_commune\"\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from cte_int_commune\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"commune\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.650710Z", "completed_at": "2025-11-18T13:40:03.669108Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.669648Z", "completed_at": "2025-11-18T13:40:03.669654Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.019647836685180664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.int_logement_rpls", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table intermediate int_logement_rpls\n *                  Filtrage, regroupement, application de conditions, calculs\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          stg_sdes_rpls_logement\n * Cible :          int_logement_rpls\n\n\n\n */\n\n\n\n\n with\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n -- S\u00e9lection des colonnes \n cte_stg_sdes_rpls_logement as \n (\n    select \n        \n        logement_rpls_millesime,\n        logement_rpls_millesime_date,\n        logement_rpls_id,\n        logement_bailleur_systeme_id,\n        organisme_id,\n        immobilier_droit_code,\n        commune_code        as commune_code_source,\n        adresse_postale_code,\n        commune_libelle,\n        adresse_voie_num,\n        adresse_voie_indice_repetition_libelle,\n        adresse_voie_type_libelle,\n        adresse_voie_libelle,\n        adresse_appartement_num,\n        adresse_boite_num,\n        adresse_escalier_num,\n        adresse_couloir_libelle,\n        adresse_etage_num,\n        adresse_logement_complement_libelle,\n        adresse_entree_num,\n        adresse_batiment_num,\n        adresse_immeuble_num,\n        adresse_batiment_complement_libelle,\n        adresse_lieu_dit_libelle,\n        qpv_flag,\n        construction_type_code,\n        piece_nombre_code,\n        surface_habitable_m2,\n        construction_achevement_annee,\n        mise_en_location_premiere_annee,\n        patrimoine_entree_annee,\n        patrimoine_origine_code,\n        proprietaire_precedent_raison_sociale_libelle,\n        proprietaire_precedent_siret_num,\n        financement_initial_code,\n        financement_autre_libelle,\n        convention_flag,\n        convention_num,\n        convention_date,\n        patrimoine_sortie_code,\n        logement_old_code,\n        logement_new_code,\n        occupation_mode_code,\n        bail_effet_mois,\n        surface_mode_code,\n        surface_mode_m2,\n        loyer_principal_mensuel_montant,\n        loyer_accessoire_mensuel_montant,\n        contribution_montant,\n        financement_cus_code,\n        dpe_mois,\n        dpe_energie_code,\n        dpe_ges_code,\n        sru_expiration_annee,\n        sru_alinea_code,\n        organisme_gestionnaire_id,\n        patrimoine_segment_code,\n        patrimoine_segment_libelle,\n        loyer_maximal_apl_mensuel_montant,\n        loyer_maximal_cus_mensuel_montant,\n        vente_type_code,\n        mise_en_commercialisation_code,\n        vente_prix_montant,\n        produit_financier_net_montant,\n        remise_en_location_mois,\n        reservation_contingent_code,\n        pmr_code                        as pmr_code_source,\n        vente_autorisation_mois,\n        vente_effective_mois,\n        locataire_dernier_depart_date,\n        dpe_energie_consommation_valeur,\n        dpe_ges_consommation_valeur,\n        dpe_reference_num,\n        logement_fiscal_id,\n        organisme_categorie_code,\n        organisme_raison_sociale_libelle,\n        organisme_siret_code,\n        --departement_code,\n        -- departement_libelle,\n        --region_code,\n        -- region_libelle,\n        --epci_code,\n        -- epci_libelle,\n        -- departements_epci_list,\n        -- regions_epci_list,\n        var_financement_groupe_libelle,\n        var_mise_en_service_flag\n        -- var_loyer_moyen_mensuel_m2_montant,\n        -- var_logement_anciennete_en_annee,\n        -- var_deconventionnement_flag,\n        -- var_duree_vacance_mois,\n        -- var_remise_en_location_annee,\n        -- var_remise_en_location_mois,\n        -- var_bail_effet_mois,\n        -- var_bail_effet_annee,\n        -- var_bail_effet_date,\n        -- var_remise_en_location_date\n\n    from \n        \"wh_dp_silver\".\"stg\".\"stg_sdes_rpls_logement\"\n ),\n\n cte_map_financement_groupe as \n (\n    select \n        financement_initial_code,\n        convention_flag,\n        financement_groupe_code\n    from   \n        \"wh_dp_bronze\".\"seed\".\"map_financement_groupe\"\n ),\n\n \n cte_map_pmr_code as \n (\n    select \n        pmr_code_source,\n        pmr_code_cible\n    from   \n        \"wh_dp_bronze\".\"seed\".\"map_pmr_code\"\n ),\n\n\ncte_int_arrondissement as\n(\n    select \n        arrondissement_annee,\n        arrondissement_code,\n        arrondissement_libelle,\n        commune_code\n    from \n        \"wh_dp_silver\".\"int\".\"int_arrondissement\"\n),\n \ncte_int_passage_commune_histo as\n(\n    select \n        passage_commune_annee,\n        commune_initiale_code,\n        commune_finale_code\n    from \n        \"wh_dp_silver\".\"int\".\"int_passage_commune_histo\"\n),\n \ncte_int_commune as\n(\n    select \n        commune_annee,\n        commune_code \n    from \n        \"wh_dp_silver\".\"int\".\"int_commune\"\n), \n \n-------------------------------------------------------------------\n--*********************** TRANSFORMATIONS *************************\n-------------------------------------------------------------------\n-- Ajout des colonnes calcul\u00e9es\n cte_calc_stg_sdes_rpls_logement  as \n (\n    select\n        \n        stg_sdes_rpls_logement.*,\n        isnull(int_arrondissement.commune_code, stg_sdes_rpls_logement.commune_code_source)                                 \n            as commune_code_origine,\n        isnull(int_arrondissement.arrondissement_code,'N/A')                                                                              \n            as arrondissement_code,\n        substring(organisme_siret_code, 1,9)                                                                                \n            as organisme_siren_code, \n        -- en incremental a voir comment mettre a jour ce champ pour les annees precedentes\n        cast (\n                \n    case\n        when year(logement_rpls_millesime) = (\n            select max(year(logement_rpls_millesime))\n            from \"wh_dp_silver\".\"stg\".\"stg_sdes_rpls_logement\"\n        ) then 1\n        else 0\n    end\n \n                as bit)                                           \n            as logement_rpls_millesime_last_flag,\n        cast ( case\n            when year(bail_effet_mois) = logement_rpls_millesime-1 AND occupation_mode_code = 1\n                then 1\n            else 0\n        end as bit)                                                                                                                \n            as emmenagement_flag ,\n        --  bail_effet_annee_prec_flag: a voir si pas la meme chose que emmenagement_flag\n        cast ( case\n            when year(bail_effet_mois) = logement_rpls_millesime-1  \n                then 1\n            else 0\n        end as bit)\n            as bail_effet_annee_prec_flag,\n     \n        cast (case\n            when year(remise_en_location_mois) = logement_rpls_millesime-1  \n                then 1\n            else 0\n        end as bit)\n            as bail_fin_annee_prec_flag,\n        case\n            when organisme_categorie_code in ('131','132','133','134','136') \n                then 'OPH'\n            when organisme_categorie_code = '211' \n                then 'ESH'\n            when organisme_categorie_code in ('251','259')\n                then 'SEM'\n            when organisme_categorie_code in ('221','222','223')\n                then 'Coop'\n            when organisme_categorie_code in ('241','611') AND substring(organisme_raison_sociale_libelle,1,12) not in ('SCI Fonci\u00e8re','SCI Fonciere') \n                then 'SACICAP'   \n            else 'Autres'\n        end                                                                                                                 \n            as organisme_famille_rpls_code,     \n        map_financement_groupe.financement_groupe_code\n            as financement_groupe_code,  \n        logement_rpls_millesime - year(construction_achevement_annee) \n            as construction_anciennete_en_annee,\n        case \n            when stg_sdes_rpls_logement.convention_flag = 0 and organisme_categorie_code in ('251','259')\n                then 1\n            else 0\n        end   \n            as sem_non_convention_flag,                                                                                                              \n        case \n            when \n                var_financement_groupe_libelle in ('Non soc inter_CDC','Non soc inter_Reunion')\n                then 1 \n            else 0\n        end  \n             as logement_loyer_libre_flag,                                                                                                              \n        -- Lors de l'int\u00e9gration de toutes les ann\u00e9es, il faudrait recalculer ce champ chez nous, car ce champ peut \u00eatre erron\u00e9\n        cast (var_mise_en_service_flag as bit)     \n            as mise_en_service_flag,\n        isnull(pmr.pmr_code_cible,stg_sdes_rpls_logement.pmr_code_source) as pmr_code                                                                                      \n        \n         \n    from \n        cte_stg_sdes_rpls_logement stg_sdes_rpls_logement\n\n    left join cte_map_financement_groupe map_financement_groupe \n        on  stg_sdes_rpls_logement.financement_initial_code = map_financement_groupe.financement_initial_code\n        and stg_sdes_rpls_logement.convention_flag = map_financement_groupe.convention_flag\n    \n    left join cte_map_pmr_code pmr\n        on stg_sdes_rpls_logement.pmr_code_source = pmr.pmr_code_source\n\n    --le code commune qui se trouve dans la table rpls, peut etre soit un code commune soit un code arrondissement\n    left join cte_int_arrondissement int_arrondissement\n        on  stg_sdes_rpls_logement.commune_code_source = int_arrondissement.arrondissement_code\n        and stg_sdes_rpls_logement.logement_rpls_millesime = int_arrondissement.arrondissement_annee\n            \n\n ),\n/*\nParfois, une commune pr\u00e9sente dans le RPLS n'existe pas dans le r\u00e9f\u00e9rentiel des communes pour la m\u00eame ann\u00e9e.\n\nExemple :\nEn 2023, le code commune 85053 est dans le RPLS, mais pas dans le r\u00e9f\u00e9rentiel.\n\nSolution :\nOn utilise une table de correspondance (appel\u00e9e \"passage commune\") pour retrouver le nouveau code de commune valide.\n\nExemple :\nDans la table de passage :\ncodgeo_ini = 85053, codgeo = 85289, ann\u00e9e = 2023\n\nOn remplace donc 85053 par 85289 dans le RPLS pour pouvoir faire la jointure avec le r\u00e9f\u00e9rentiel.\n*/\ncte_corrige_commune_rpls_logement as\n(\n\n    select \n        cte_calc_stg_sdes_rpls_logement.*\n        , isnull(cte_int_passage_commune_histo.commune_finale_code, cte_calc_stg_sdes_rpls_logement.commune_code_origine)\n            as commune_code\n\n    from cte_calc_stg_sdes_rpls_logement\n    left join cte_int_passage_commune_histo \n        on (\n            cte_calc_stg_sdes_rpls_logement.commune_code_origine = cte_int_passage_commune_histo.commune_initiale_code\n            and\n            cte_calc_stg_sdes_rpls_logement.logement_rpls_millesime = cte_int_passage_commune_histo.passage_commune_annee\n            and\n            -- que pour les communes du rpls qu'on ne trouve pas dans le referentiel\n            not exists (\n                select commune_code\n                from\n                    cte_int_commune\n                where \n                    cte_int_commune.commune_code = cte_calc_stg_sdes_rpls_logement.commune_code_origine\n                    and\n                    cte_int_commune.commune_annee = cte_calc_stg_sdes_rpls_logement.logement_rpls_millesime\n                        )\n        )\n  \n),\n\n-- Ajout des cl\u00e9s business\ncte_bk_calc_sdes_rpls_logement as\n(\n    select \n        *\n        ,  \n    \n        concat_ws('||', logement_rpls_millesime, logement_rpls_id, logement_bailleur_systeme_id, organisme_id) \n    \n  \n                as logement_rpls_bk\n        ,   \n    \n        concat_ws('||', logement_rpls_millesime, commune_code) \n    \n  \n                as commune_bk\n        ,   \n    \n        concat_ws('||', logement_rpls_millesime, arrondissement_code) \n    \n   \n                as arrondissement_bk\n    from \n        cte_corrige_commune_rpls_logement\n\n),\n-- Ajout des cl\u00e9s techniques\ncte_hk_calc_sdes_rpls_logement as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(logement_rpls_bk as varchar(max))\n    \n)  \n \n              as logement_rpls_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(commune_bk as varchar(max))\n    \n)  \n \n                    as commune_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(arrondissement_bk as varchar(max))\n    \n)  \n \n             as arrondissement_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(occupation_mode_code as varchar(max))\n    \n)  \n \n          as occupation_mode_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(financement_initial_code as varchar(max))\n    \n)  \n \n      as financement_initial_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(financement_groupe_code as varchar(max))\n    \n)  \n \n       as financement_groupe_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(pmr_code as varchar(max))\n    \n)  \n \n                      as pmr_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(piece_nombre_code as varchar(max))\n    \n)  \n \n             as piece_nombre_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(surface_mode_code as varchar(max))\n    \n)  \n \n             as surface_mode_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(dpe_energie_code as varchar(max))\n    \n)  \n \n              as dpe_energie_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(dpe_ges_code as varchar(max))\n    \n)  \n \n                  as dpe_ges_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(vente_type_code as varchar(max))\n    \n)  \n \n               as vente_type_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(patrimoine_sortie_code as varchar(max))\n    \n)  \n \n        as patrimoine_sortie_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(patrimoine_origine_code as varchar(max))\n    \n)  \n \n       as patrimoine_origine_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(construction_type_code as varchar(max))\n    \n)  \n \n        as construction_type_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(immobilier_droit_code as varchar(max))\n    \n)  \n \n         as immobilier_droit_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_famille_rpls_code as varchar(max))\n    \n)  \n \n   as organisme_famille_hk \n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(organisme_categorie_code as varchar(max))\n    \n)  \n \n      as organisme_categorie_hk \n \n    from \n        cte_bk_calc_sdes_rpls_logement\n),\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_hk_calc_sdes_rpls_logement\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"int\".\"int_logement_rpls\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.670908Z", "completed_at": "2025-11-18T13:40:03.680540Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.680995Z", "completed_at": "2025-11-18T13:40:03.681002Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010715723037719727, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_ept", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_ept\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          ept\n * Cible :          dim_ept \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_ept as\n(\n    select \n        ept_code,\n        ept_libelle,\n       -- epci_code,\n        ept_annee_last_flag\n    \n    from\n        \"wh_dp_silver\".\"dbo\".\"ept\"\n\n),\n\n-- Application des filtres \ncte_filtered_ept as\n(\n    select \n        ept_code,\n        ept_libelle\n       -- epci_code\n\n    from\n        cte_ept\n    where\n        ept_annee_last_flag = 1\n),\n\n-- Ajout des cl\u00e9s techniques (diff\u00e9rentes de la couche silver car sans ann\u00e9e )\ncte_hk_filtered_ept as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(ept_code as varchar(max))\n    \n)  \n \n       as ept_hk\n \n\n    from \n        cte_filtered_ept\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_filtered_ept\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_ept\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.682384Z", "completed_at": "2025-11-18T13:40:03.691776Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.692217Z", "completed_at": "2025-11-18T13:40:03.692223Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010492324829101562, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_departement", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_departement\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          commune\n * Cible :          dim_departement\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_departement as\n(\n    select \n        departement_code,\n        departement_libelle,\n        region_code,\n        region_av15_code,\n        departement_annee_last_flag\n    \n    from\n        \"wh_dp_silver\".\"dbo\".\"departement\"\n\n),\n\n-- Application des filtres \ncte_filtered_departement as\n(\n    select \n       \n        departement_code,\n        departement_libelle,\n        region_code,\n        region_av15_code\n\n    from\n        cte_departement\n    where\n        departement_annee_last_flag = 1\n),\n\n-- Ajout des cl\u00e9s techniques (diff\u00e9rentes de la couche silver car sans ann\u00e9e )\ncte_hk_filtered_departement as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(departement_code as varchar(max))\n    \n)  \n \n    as departement_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(region_code as varchar(max))\n    \n)  \n \n         as region_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast( region_av15_code as varchar(max))\n    \n)  \n \n   as  region_av15_hk\n\n    from \n        cte_filtered_departement\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_filtered_departement\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_departement\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.693533Z", "completed_at": "2025-11-18T13:40:03.701855Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.702288Z", "completed_at": "2025-11-18T13:40:03.702295Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009356975555419922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_region", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_region\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          region\n * Cible :          dim_region\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_region as\n(\n    select \n  \n        region_code,\n        region_libelle,\n        region_idf_flag,\n        region_outre_mer_flag,\n        region_annee_last_flag\n    \n    from\n        \"wh_dp_silver\".\"dbo\".\"region\"\n\n),\n\n-- Application des filtres \ncte_filtered_region as\n(\n    select \n       \n        region_code,\n        region_libelle,\n        region_idf_flag,\n        region_outre_mer_flag\n\n    from\n        cte_region\n    where\n       region_annee_last_flag = 1 \n),\n\n-- Ajout des cl\u00e9s techniques (diff\u00e9rentes de la couche silver car sans ann\u00e9e )\ncte_hk_filtered_region as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(region_code as varchar(max))\n    \n)  \n \n       as region_hk\n\n    from \n        cte_filtered_region\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_filtered_region\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_region\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.703619Z", "completed_at": "2025-11-18T13:40:03.712374Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:03.712836Z", "completed_at": "2025-11-18T13:40:03.712843Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010219335556030273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_epci", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table epci\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_epci\n * Cible :          epci \n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_epci as\n(\n    select \n        epci_code,\n        epci_libelle,\n        epci_annee_last_flag\n    \n    from\n        \"wh_dp_silver\".\"dbo\".\"epci\"\n\n),\n\n-- Application des filtres \ncte_filtered_ecpi as\n(\n    select \n        epci_code,\n        epci_libelle\n\n    from\n        cte_epci\n    where\n        epci_annee_last_flag = 1\n),\n\n-- Ajout des cl\u00e9s techniques (diff\u00e9rentes de la couche silver car sans ann\u00e9e )\ncte_hk_filtered_ecpi as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(epci_code as varchar(max))\n    \n)  \n \n       as epci_hk\n \n\n    from \n        cte_filtered_ecpi\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_filtered_ecpi\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_epci\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:03.714617Z", "completed_at": "2025-11-18T13:40:04.022311Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:04.023455Z", "completed_at": "2025-11-18T13:40:04.023468Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.309589147567749, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.datamart_commune", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table datamart_commune\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          silver - geographie\n * Cible :          datamart_commune\n\n * A utiliser uniquement pour exposition ou visualisation des donn\u00e9es\n * Ne pas utiliser en tant que source pour alimenter une table/vue\n */\n\n\n\n\n-- Selection des tables et des colonnes\nwith \n\ncte_commune as\n(\n    select \n        commune_hk,\n        commune_annee,\n        commune_annee_last_flag,\n        commune_code,\n        commune_libelle,    \n        commune_pays_libelle,\n        departement_hk,      \n        epci_hk,      \n        ept_hk,    \n        zone_123_hk,   \n        zone_abc_hk,\n        logements_prives_nombre\n    from   \n        \"wh_dp_silver\".\"dbo\".\"commune\"\n),\n\ncte_departement as\n(\n    select \n        departement_code,\n        departement_libelle,\n        departement_hk,\n        region_hk,\n        region_av15_hk\n    from   \n        \"wh_dp_silver\".\"dbo\".\"departement\"\n),\n\ncte_region as\n(\n    select \n        region_code,\n        region_libelle,\n        region_hk,\n        region_idf_flag,\n        region_outre_mer_flag,\n        region_outre_mer_flag_libelle\n    from \n         \"wh_dp_silver\".\"dbo\".\"region\"\n),\n\ncte_epci as\n(\n    select\n \n        epci_code,\n        epci_libelle,\n        epci_nature_code,\n        epci_hk\n    from \n         \"wh_dp_silver\".\"dbo\".\"epci\"\n),\n\ncte_ept as\n(\n    select\n        ept_code,\n        ept_libelle,\n        ept_hk\n    from \n        \"wh_dp_silver\".\"dbo\".\"ept\"\n\n),\n\ncte_zone_123 as\n(\n    select\n        zone_123_code,\n        zone_123_libelle,\n        zone_123_hk\n    from \n        \"wh_dp_silver\".\"dbo\".\"zone_123\"\n),\n\ncte_zone_abc as \n(\n    select \n        zone_abc_code,\n        zone_abc_libelle,\n        zone_abc_hk\n    from \n        \"wh_dp_silver\".\"dbo\".\"zone_abc\"\n),\n\n-- Filtrage (derni\u00e8re version de la g\u00e9ographie)\ncte_commune_last_version as\n(\n    select \n        commune_hk,\n        commune_annee,\n        commune_code,\n        commune_libelle,  \n        commune_pays_libelle,  \n        departement_hk,      \n        epci_hk,      \n        ept_hk,    \n        zone_123_hk,   \n        zone_abc_hk,\n        logements_prives_nombre\n    from \n        cte_commune\n    where \n        commune_annee_last_flag = 1\n),\n\n-- jointure\ncte_geographie_last_version as\n(\n    select\n        commune.commune_hk,\n        commune.commune_annee,\n        commune.commune_code,\n        commune.commune_libelle, \n        commune.commune_pays_libelle,   \n        commune.logements_prives_nombre,\n        departement.departement_code,\n        departement.departement_libelle,\n        region.region_code,\n        region.region_libelle,\n        region.region_idf_flag,\n        region.region_outre_mer_flag,\n        region_outre_mer_flag_libelle,                                  \n        epci.epci_code,\n        epci.epci_libelle,\n        epci.epci_nature_code,\n        ept.ept_code,\n        ept.ept_libelle,\n        zone_123.zone_123_code,\n        zone_123.zone_123_libelle,\n        zone_abc.zone_abc_code,\n        zone_abc.zone_abc_libelle\n        \n\n    from \n        cte_commune_last_version commune\n    inner join\n        cte_departement departement on (commune.departement_hk = departement.departement_hk)\n    inner join \n        cte_region region on (departement.region_hk = region.region_hk)\n    left join \n        cte_epci epci on (commune.epci_hk = epci.epci_hk)\n    left join\n        cte_ept ept on (commune.ept_hk = ept.ept_hk)\n    left join\n        cte_zone_123 zone_123 on (commune.zone_123_hk = zone_123.zone_123_hk)\n    left join  \n        cte_zone_abc zone_abc on (commune.zone_abc_hk = zone_abc.zone_abc_hk)\n),\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n \ncte_finale as\n(\n    select\n        *\n    from\n        cte_geographie_last_version\n)\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"datamart_commune\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:04.026764Z", "completed_at": "2025-11-18T13:40:04.039345Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:04.039985Z", "completed_at": "2025-11-18T13:40:04.039994Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.014721155166625977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_commune", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_commune\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          commune\n * Cible :          dim_commune\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n-- S\u00e9lection des colonnes \ncte_commune as\n(\n    select \n       \n        commune_code,\n        commune_libelle,\n        commune_pays_libelle,\n        departement_code,\n        ept_code,\n        epci_code,\n        commune_annee,\n        commune_annee_last_flag,\n        zone_123_code,\n        zone_abc_code,\n        logements_prives_nombre\n    \n    from\n        \"wh_dp_silver\".\"dbo\".\"commune\"\n\n),\n\n-- Application des filtres \ncte_filtered_commune as\n(\n    select \n       \n        commune_code,\n        commune_libelle,\n        commune_pays_libelle,\n        departement_code,\n        ept_code,\n        epci_code,\n        commune_annee,\n        zone_123_code,\n        zone_abc_code,\n        logements_prives_nombre\n\n    from\n        cte_commune\n    where\n        commune_annee_last_flag = 1\n),\n\n-- Ajout des cl\u00e9s techniques (diff\u00e9rentes de la couche silver car sans ann\u00e9e )\ncte_hk_filtered_commune as\n(\n    select \n        *\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(commune_code as varchar(max))\n    \n)  \n \n        as commune_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(departement_code as varchar(max))\n    \n)  \n \n    as departement_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(ept_code as varchar(max))\n    \n)  \n \n            as ept_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(epci_code as varchar(max))\n    \n)  \n \n           as epci_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(zone_123_code as varchar(max))\n    \n)  \n \n       as zone_123_hk\n        , \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(zone_abc_code as varchar(max))\n    \n)  \n \n       as zone_abc_hk\n\n    from \n        cte_filtered_commune\n),\n\n-- Ajout des champs techniques\ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_filtered_commune\n)\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_commune\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:04.042067Z", "completed_at": "2025-11-18T13:40:04.056702Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:04.057288Z", "completed_at": "2025-11-18T13:40:04.057296Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.016217470169067383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.logement_rpls", "compiled": true, "compiled_code": "\n\n\nwith\n\n cte_int_rpls_logement as \n (\n    select \n        logement_rpls_bk,\n        logement_rpls_hk,\n        logement_rpls_millesime,\n        logement_rpls_millesime_date,\n        logement_rpls_millesime_last_flag,\n        logement_rpls_id,\n        logement_bailleur_systeme_id,\n        organisme_id,\n        organisme_categorie_code,\n        organisme_raison_sociale_libelle,\n        organisme_siret_code,\n        organisme_famille_rpls_code,\n        organisme_siren_code,\n        commune_code,\n        arrondissement_code,\n        adresse_postale_code,\n        commune_libelle,\n        adresse_voie_num,\n        adresse_voie_indice_repetition_libelle,\n        adresse_voie_type_libelle,\n        adresse_voie_libelle,\n        adresse_appartement_num,\n        adresse_boite_num,\n        adresse_escalier_num,\n        adresse_couloir_libelle,\n        adresse_etage_num,\n        adresse_logement_complement_libelle,\n        adresse_entree_num,\n        adresse_batiment_num,\n        adresse_immeuble_num,\n        adresse_batiment_complement_libelle,\n        adresse_lieu_dit_libelle,\n        qpv_flag,\n        construction_type_code,\n        immobilier_droit_code,\n        piece_nombre_code,\n        surface_habitable_m2,\n        construction_achevement_annee,\n        mise_en_location_premiere_annee,\n        patrimoine_entree_annee,\n        patrimoine_origine_code,\n        proprietaire_precedent_raison_sociale_libelle,\n        proprietaire_precedent_siret_num,\n        financement_initial_code,\n        financement_autre_libelle,\n        convention_flag,\n        convention_num,\n        convention_date,\n        patrimoine_sortie_code,\n        logement_old_code,\n        logement_new_code,\n        occupation_mode_code,\n        bail_effet_mois,\n        surface_mode_code,\n        surface_mode_m2,\n        loyer_principal_mensuel_montant,\n        loyer_accessoire_mensuel_montant,\n        contribution_montant,\n        financement_cus_code,\n        dpe_mois,\n        dpe_energie_code,\n        dpe_ges_code,\n        sru_expiration_annee,\n        sru_alinea_code,\n        organisme_gestionnaire_id,\n        patrimoine_segment_code,\n        patrimoine_segment_libelle,\n        loyer_maximal_apl_mensuel_montant,\n        loyer_maximal_cus_mensuel_montant,\n        vente_type_code,\n        mise_en_commercialisation_code,\n        vente_prix_montant,\n        produit_financier_net_montant,\n        remise_en_location_mois,\n        reservation_contingent_code,\n        pmr_code,\n        vente_autorisation_mois,\n        vente_effective_mois,\n        locataire_dernier_depart_date,\n        dpe_energie_consommation_valeur,\n        dpe_ges_consommation_valeur,\n        dpe_reference_num,\n        logement_fiscal_id,\n        emmenagement_flag,\n        sem_non_convention_flag,\n        logement_loyer_libre_flag,\n        mise_en_service_flag,\n        bail_effet_annee_prec_flag,\n        bail_fin_annee_prec_flag,\n        financement_groupe_code,\n        construction_anciennete_en_annee,\n        occupation_mode_hk,\n        financement_initial_hk,\n        financement_groupe_hk,\n        commune_hk,\n        arrondissement_hk,\n        organisme_famille_hk,\n        organisme_categorie_hk,\n        pmr_hk,\n        piece_nombre_hk,\n        surface_mode_hk,\n        dpe_energie_hk,\n        dpe_ges_hk,\n        vente_type_hk,\n        patrimoine_sortie_hk,\n        patrimoine_origine_hk,\n        construction_type_hk,\n        immobilier_droit_hk\n \n    from \n        \"wh_dp_silver\".\"int\".\"int_logement_rpls\"\n )\n,\n\n cte_finale as \n (\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from \n        cte_int_rpls_logement\n )\n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_silver\".\"dbo\".\"logement_rpls\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:04.059632Z", "completed_at": "2025-11-18T13:40:04.072767Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:04.073315Z", "completed_at": "2025-11-18T13:40:04.073323Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.014573097229003906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.dim_calendrier", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table dim_calendrier\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source :         logement_rpls - on r\u00e9cup\u00e8re le min et le max de rpls_annee pour g\u00e9n\u00e9rer les dates\n * Cible :          dim_calendrier\n */\n\n\n\nwith\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\ncte_logement_rpls as (\n    select logement_rpls_millesime\n    from \"wh_dp_silver\".\"dbo\".\"logement_rpls\"\n),\n\ncte_min_max_annee as (\n    select \n        min(logement_rpls_millesime) as min_annee,\n        max(logement_rpls_millesime) as max_annee\n    from cte_logement_rpls\n),\n\ncte_calendrier as (\n    select  \n        date_iso,\n        date_annee_int\n    from \"wh_dp_silver\".\"dbo\".\"calendrier\"\n\n),\n-------------------------------------------------------------------\n--***************** LIMITATION DES DATES **************************\n-------------------------------------------------------------------\n-- on prend uniquement les dates qui correspondent aux mill\u00e9simes RPLS int\u00e9gr\u00e9s \ncte_all_dates as (\n    select\n        calendrier.date_iso,\n        calendrier.date_annee_int\n    from \n        cte_calendrier calendrier\n        inner join cte_min_max_annee min_max \n            on (calendrier.date_annee_int between min_max.min_annee and min_max.max_annee)\n\n         \n)\n\n-------------------------------------------------------------------\n--*********************** TABLE EN SORTIE *************************\n-------------------------------------------------------------------\nselect\n    date_iso        as date_jour,\n    date_annee_int  as annee\nfrom cte_all_dates", "relation_name": "\"wh_dp_gold\".\"dbo\".\"dim_calendrier\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-18T13:40:04.075109Z", "completed_at": "2025-11-18T13:40:04.086274Z"}, {"name": "execute", "started_at": "2025-11-18T13:40:04.086745Z", "completed_at": "2025-11-18T13:40:04.086751Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012413978576660156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_dataplatform.fait_parc_social_annee", "compiled": true, "compiled_code": "/**\n *\n * Description :    Alimentation de la table de fait parc social\n * Fr\u00e9quence :      Annuel\n * Mode :           Insert/update\n * Source:          int_logement_rpls\n * Cible :          logement_rpls  \n\n */\n\n\n\n\nwith\n\n-------------------------------------------------------------------\n--*********************** TABLE EN ENTREE *************************\n-------------------------------------------------------------------\n \ncte_logement_rpls as\n(\n    select\n        logement_rpls_hk\n        -- ANNEE\n        ,logement_rpls_millesime_date   \n        ,construction_anciennete_en_annee \n        ,construction_achevement_annee \n        -- FLAG\n        ,qpv_flag\n        ,mise_en_service_flag\n        ,sem_non_convention_flag\n        ,logement_loyer_libre_flag\n        ,bail_effet_annee_prec_flag\n        ,bail_fin_annee_prec_flag\n        ,emmenagement_flag\n        -- SURFACE\n        ,surface_habitable_m2\n        -- MONTANT\n        ,loyer_principal_mensuel_montant\n        -- CODE\n        ,piece_nombre_code\n        ,dpe_energie_code\n        ,dpe_ges_code\n        ,patrimoine_sortie_code     as patrimoine_sortie_code_source\n        ,vente_type_code      \n        ,commune_code               as commune_code_source\n        ,organisme_famille_rpls_code\n        ,financement_groupe_code\n        ,occupation_mode_code\n        ,construction_type_code\n        ,patrimoine_origine_code\n        ,pmr_code                    \n        -- HK\n        ,financement_groupe_hk\n        ,patrimoine_origine_hk\n        ,dpe_ges_hk\n        ,dpe_energie_hk    \n        ,occupation_mode_hk  \n        ,construction_type_hk   \n        ,organisme_famille_hk\n        ,piece_nombre_hk\n        ,pmr_hk                      \n         \n\n    from\n        \"wh_dp_silver\".\"dbo\".\"logement_rpls\"\n\n),\n\ncte_map_patrimoine_sortie as \n(\n    select\n        patrimoine_sortie_code_silver\n        , vente_type_code_silver\n        , patrimoine_sortie_code_gold\n        , patrimoine_sortie_gold_libelle\n\n    from    \n        \"wh_dp_bronze\".\"seed\".\"map_patrimoine_sortie\"\n),\n\ncte_passage_commune_histo as\n(\n    select \n        passage_commune_annee\n        , passage_commune_annee_last_flag\n        , commune_initiale_code\n        , commune_finale_code\n    from\n        \"wh_dp_silver\".\"dbo\".\"passage_commune_histo\"\n),\n\n-- la dimension commune contient la derni\u00e8re version  \ncte_commune as \n(\n    select \n        commune_annee,\n        commune_code,\n        commune_hk,\n        departement_code,\n        departement_hk,\n        epci_code,\n        epci_hk,\n        ept_code,\n        ept_hk,\n        zone_123_code,\n        zone_123_hk,\n        zone_abc_code,\n        zone_abc_hk\n    from \n        \"wh_dp_gold\".\"dbo\".\"dim_commune\"\n),\n\n-- la dimension departement contient la derni\u00e8re version  \ncte_departement as \n(\n    select \n        departement_hk, \n        region_hk,\n        region_code\n    from \n        \"wh_dp_gold\".\"dbo\".\"dim_departement\"\n),\n\n-- la dimension region contient la derni\u00e8re version\ncte_region as\n(\n    select \n        region_hk,\n        region_outre_mer_flag\n     from \n        \"wh_dp_gold\".\"dbo\".\"dim_region\"\n),\n\n\ncte_ref_dataplatform as\n(\n    select \n        \n        objet\n        , code \n        , val1\n        , val2\n    from \n        \"wh_dp_bronze\".\"seed\".\"ref_dataplatform\"\n\n),\n-------------------------------------------------------------------\n--*************************** FILTRES *****************************\n-------------------------------------------------------------------\n\n --recuperation de la derni\u00e8re version des passages communes\n cte_passage_commune_histo_last as\n (\n    select\n        *\n    from cte_passage_commune_histo\n    where \n        passage_commune_annee_last_flag = 1\n       \n ),\n\n \ncte_dim_construction_periode as \n(\n    select \n        code\n        , val1\n        , val2\n    from \n        cte_ref_dataplatform\n    where \n        objet = 'dim_construction_periode'\n\n),\n\n\n\n-------------------------------------------------------------------\n--************************* TRAITEMENTS ***************************\n-------------------------------------------------------------------\n\n cte_commune_fusionnee as\n(\nselect  commune_initiale_code,\n        commune_finale_code\nfrom  cte_passage_commune_histo_last base\nwhere not exists (select 1 \n      \n      from cte_passage_commune_histo_last cte_passage_commune_histo\n      where\n           base.commune_initiale_code = cte_passage_commune_histo.commune_finale_code\n            )\n),\n\n-- Pr\u00e9paration des axes d'analyses\ncte_transform_logement_rpls as\n(\n    select\n        cte_logement_rpls.*\n        -- R\u00e8gle de d\u00e9termination du code commune :\n        -- 1. Si le code commune du RPLS est pr\u00e9sent dans le champ \"commune_finale\" de la table de passage,\n        --    alors on conserve ce code (le code n\u2019a pas chang\u00e9, ex : scission).\n        -- 2. Sinon, on recherche dans la table de passage la ligne o\u00f9 :\n        --       \"commune_initiale\" = code commune du RPLS,\n        --    et on r\u00e9cup\u00e8re le code \"commune_finale\" correspondant (le code a chang\u00e9, ex : fusion).\n        --\n        -- Autrement dit :\n        -- - En cas de **scission**, la commune garde son code d\u2019origine.\n        -- - En cas de **fusion**, la commune prend le nouveau code issu de la table de passage.\n        , case when exists (select 1 \n                            from  cte_logement_rpls   \n                            inner join cte_passage_commune_histo\n                            on (\n                                cte_logement_rpls.commune_code_source = cte_passage_commune_histo.commune_finale_code\n                                and  cte_passage_commune_histo.passage_commune_annee_last_flag = 1\n                            ))\n                    then cte_logement_rpls.commune_code_source  \n                else cte_commune_fusionnee.commune_initiale_code  \n        end as commune_code\n        , isnull(cte_map_patrimoine_sortie.patrimoine_sortie_code_gold, 'N/A')   as patrimoine_sortie_code\n        , isnull(cte_dim_construction_periode.code, 'N/A')                       as construction_periode_code\n    from \n        cte_logement_rpls   \n    left join\n        cte_map_patrimoine_sortie on (\n            cte_logement_rpls.patrimoine_sortie_code_source = cte_map_patrimoine_sortie.patrimoine_sortie_code_silver\n            and (\n                cte_map_patrimoine_sortie.vente_type_code_silver = '-'\n                or\n                cte_logement_rpls.vente_type_code = cte_map_patrimoine_sortie.vente_type_code_silver \n                )\n                                            \n        )\n     left join \n        cte_dim_construction_periode on (\n            year(cte_logement_rpls.construction_achevement_annee) between cte_dim_construction_periode.val1 and cte_dim_construction_periode.val2\n\n        )\n    left join \n    cte_commune_fusionnee as cte_commune_fusionnee on (     \n        cte_logement_rpls.commune_code_source =   cte_commune_fusionnee.commune_initiale_code\n        \n    )\n    \n\n),\n\n-- On ajoute les informations de la commune\ncte_infos_commune_logement_rpls as\n(\n    select \n        cte_transform_logement_rpls.*\n        , cte_commune.commune_annee as geographie_annee\n        , cte_commune.commune_hk\n        , cte_commune.departement_code\n        , cte_commune.departement_hk\n        , cte_commune.epci_code\n        , cte_commune.epci_hk\n        , cte_commune.ept_code\n        , cte_commune.ept_hk\n        , cte_departement.region_code\n        , cte_departement.region_hk\n        , cte_region.region_outre_mer_flag\n        , cte_commune.zone_123_code\n        , cte_commune.zone_123_hk\n        , cte_commune.zone_abc_code\n        , cte_commune.zone_abc_hk\n \n    from \n        cte_transform_logement_rpls\n    inner join cte_commune\n    on (cte_transform_logement_rpls.commune_code = cte_commune.commune_code )\n    inner join cte_departement\n    on (cte_commune.departement_hk = cte_departement.departement_hk)\n    inner join cte_region\n    on (cte_departement.region_hk = cte_region.region_hk)\n),\n\n-- Exlusion des SEM non conventionn\u00e9es (except\u00e9 pour les DOM-TOM) et des logements \u00e0 loyer libre\ncte_filtre_logement_rpls as\n(\n    select \n        *\n    from\n        cte_infos_commune_logement_rpls\n    where \n        (\n            (sem_non_convention_flag <> 1 or region_outre_mer_flag = 1)\n            and\n            logement_loyer_libre_flag <> 1\n             \n\n        )\n        \n),\n \n-- Calcul des indicateurs et aggr\u00e9gation\n cte_calc_logement_rpls as \n (\n    select\n        logement_rpls_millesime_date                                            as rpls_annee\n        , commune_code \n        , departement_code\n        , region_code   \n        , epci_code\n        , ept_code\n        , zone_123_code\n        , zone_abc_code\n        , piece_nombre_code                                                      \n        , qpv_flag    \n        , bail_effet_annee_prec_flag        \n        , bail_fin_annee_prec_flag     \n        , emmenagement_flag\n        , mise_en_service_flag               \n        , financement_groupe_code\n        , dpe_energie_code\n        , dpe_ges_code\n        , patrimoine_origine_code\n        , construction_type_code\n        , occupation_mode_code\n        , patrimoine_sortie_code                                                                                                                                                    \n        , construction_periode_code   \n        , organisme_famille_rpls_code     \n        , pmr_code                                       \n        , sum(construction_anciennete_en_annee)                                 as construction_anciennete_en_annee\n        , count(logement_rpls_hk)                                               as logement_total_nombre\n        , sum(surface_habitable_m2)                                             as surface_habitable_m2\n        , sum(loyer_principal_mensuel_montant)                                  as loyer_principal_mensuel_montant\n        , dpe_energie_hk\n        , dpe_ges_hk\n        , commune_hk\n        , patrimoine_origine_hk\n        , construction_type_hk\n        , occupation_mode_hk \n        , financement_groupe_hk\n        , piece_nombre_hk\n        , organisme_famille_hk\n        , departement_hk\n        , region_hk  \n        , epci_hk\n        , ept_hk\n        , zone_123_hk\n        , zone_abc_hk\n        , pmr_hk\n    \n\n    from \n        cte_filtre_logement_rpls\n    \n    group by\n        logement_rpls_millesime_date                                                     \n        , commune_code \n        , departement_code\n        , region_code   \n        , epci_code\n        , ept_code\n        , zone_123_code\n        , zone_abc_code\n        , piece_nombre_code                                                      \n        , qpv_flag       \n        , bail_effet_annee_prec_flag        \n        , bail_fin_annee_prec_flag  \n        , emmenagement_flag\n        , mise_en_service_flag                                                 \n        , financement_groupe_code\n        , dpe_energie_code\n        , dpe_ges_code\n        , patrimoine_origine_code\n        , construction_type_code\n        , occupation_mode_code\n        , patrimoine_sortie_code                                                                                                                                                    \n        , construction_periode_code   \n        , organisme_famille_rpls_code\n        , pmr_code\n        , dpe_energie_hk\n        , dpe_ges_hk\n        , patrimoine_origine_hk\n        , construction_type_hk\n        , occupation_mode_hk \n        , financement_groupe_hk\n        , piece_nombre_hk\n        , organisme_famille_hk\n        , commune_hk\n        , departement_hk\n        , region_hk  \n        , epci_hk\n        , ept_hk\n        , zone_123_hk\n        , zone_abc_hk\n        , pmr_hk\n\n ),\n\n -- Calcul des cl\u00e9s techniques pour celles qui ne sont pas directement r\u00e9cup\u00e9r\u00e9es de la couche silver\ncte_hk_calc_logement_rpls as\n (\n    select     \n        cte_calc_logement_rpls.*\n\n    ,   \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(patrimoine_sortie_code as varchar(max))\n    \n)  \n \n    as patrimoine_sortie_hk\n    ,   \n     \n        HASHBYTES('SHA2_256', \n    \n        cast(construction_periode_code as varchar(max))\n    \n)  \n \n as construction_periode_hk\n    from \n        cte_calc_logement_rpls\n ),\n        \n\n-------------------------------------------------------------------\n--************************ ETAPE FINALE **************************\n-------------------------------------------------------------------\n \ncte_finale as\n(\n    select\n        *\n        , \n    CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'Romance Standard Time' AS datetime2(3))\n as _meta_loaded_at\n    from\n        cte_hk_calc_logement_rpls\n)\n\nselect \n    *\nfrom \n    cte_finale", "relation_name": "\"wh_dp_gold\".\"dbo\".\"fait_parc_social_annee\"", "batch_results": null}], "elapsed_time": 6.050464868545532, "args": {"write_json": true, "use_fast_test_edges": false, "print": true, "exclude": [], "validate_macro_args": false, "send_anonymous_usage_stats": true, "project_dir": "C:\\Users\\mgueye\\dbt_projects\\dbt_dataplatform", "invocation_command": "dbt docs generate", "defer": false, "compile": true, "show_resource_report": false, "quiet": false, "require_generic_test_arguments_property": true, "require_nested_cumulative_type_params": false, "log_format_file": "debug", "log_file_max_bytes": 10485760, "macro_debugging": false, "cache_selected_only": false, "source_freshness_run_project_hooks": true, "log_path": "C:\\Users\\mgueye\\dbt_projects\\dbt_dataplatform\\logs", "vars": {}, "populate_cache": true, "require_resource_names_without_spaces": true, "static_parser": true, "state_modified_compare_vars": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "profiles_dir": "C:\\Users\\mgueye\\dbt_projects\\dbt_dataplatform", "log_level": "info", "require_yaml_configuration_for_mf_time_spines": false, "state_modified_compare_more_unrendered_values": false, "printer_width": 80, "require_batched_execution_for_custom_microbatch_strategy": false, "require_all_warnings_handled_by_warn_error": false, "select": [], "use_colors": true, "version_check": true, "log_format": "default", "strict_mode": false, "indirect_selection": "eager", "log_level_file": "debug", "partial_parse_file_diff": true, "show_all_deprecations": false, "skip_nodes_if_on_run_start_fails": false, "upload_to_artifacts_ingest_api": false, "partial_parse": true, "use_colors_file": true, "which": "generate", "require_explicit_package_overrides_for_builtin_materializations": true, "favor_state": false, "static": false, "empty_catalog": false, "introspect": true}}